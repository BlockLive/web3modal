import{j as So,f as kt,b as xo,e as dt,r as Io}from"./index-c3a5c559.js";import{t as wt}from"./tslib-795b6beb.js";import{b as Pi,s as Oo,a as Ao,d as Co,i as us,c as Po,e as To,g as Pn,f as Ti,h as No,J as gr,j as Ni,k as Ri,l as Nt,m as Ot,n as Tn,o as Fi,H as Br}from"./index-1d7ae758.js";var ei,ls;function Ro(){if(ls)return ei;ls=1;function r(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}ei=e;function e(t,i,s){var c=s&&s.stringify||r,u=1;if(typeof t=="object"&&t!==null){var o=i.length+u;if(o===1)return t;var h=new Array(o);h[0]=c(t);for(var g=1;g<o;g++)h[g]=c(i[g]);return h.join(" ")}if(typeof t!="string")return t;var b=i.length;if(b===0)return t;for(var O="",P=1-u,D=-1,A=t&&t.length||0,T=0;T<A;){if(t.charCodeAt(T)===37&&T+1<A){switch(D=D>-1?D:0,t.charCodeAt(T+1)){case 100:case 102:if(P>=b||i[P]==null)break;D<T&&(O+=t.slice(D,T)),O+=Number(i[P]),D=T+2,T++;break;case 105:if(P>=b||i[P]==null)break;D<T&&(O+=t.slice(D,T)),O+=Math.floor(Number(i[P])),D=T+2,T++;break;case 79:case 111:case 106:if(P>=b||i[P]===void 0)break;D<T&&(O+=t.slice(D,T));var N=typeof i[P];if(N==="string"){O+="'"+i[P]+"'",D=T+2,T++;break}if(N==="function"){O+=i[P].name||"<anonymous>",D=T+2,T++;break}O+=c(i[P]),D=T+2,T++;break;case 115:if(P>=b)break;D<T&&(O+=t.slice(D,T)),O+=String(i[P]),D=T+2,T++;break;case 37:D<T&&(O+=t.slice(D,T)),O+="%",D=T+2,T++,P--;break}++P}++T}return D===-1?t:(D<A&&(O+=t.slice(D)),O)}return ei}var ti,fs;function Nn(){if(fs)return ti;fs=1;const r=Ro();ti=s;const e=w().console||{},t={mapHttpRequest:A,mapHttpResponse:A,wrapRequestSerializer:T,wrapResponseSerializer:T,wrapErrorSerializer:T,req:A,res:A,err:P};function i(f,n){return Array.isArray(f)?f.filter(function(R){return R!=="!stdSerializers.err"}):f===!0?Object.keys(n):!1}function s(f){f=f||{},f.browser=f.browser||{};const n=f.browser.transmit;if(n&&typeof n.send!="function")throw Error("pino: transmit option must have a send function");const l=f.browser.write||e;f.browser.write&&(f.browser.asObject=!0);const R=f.serializers||{},F=i(f.browser.serialize,R);let H=f.browser.serialize;Array.isArray(f.browser.serialize)&&f.browser.serialize.indexOf("!stdSerializers.err")>-1&&(H=!1);const V=["error","fatal","warn","info","debug","trace"];typeof l=="function"&&(l.error=l.fatal=l.warn=l.info=l.debug=l.trace=l),f.enabled===!1&&(f.level="silent");const X=f.level||"info",E=Object.create(l);E.log||(E.log=N),Object.defineProperty(E,"levelVal",{get:k}),Object.defineProperty(E,"level",{get:z,set:L});const C={transmit:n,serialize:F,asObject:f.browser.asObject,levels:V,timestamp:D(f)};E.levels=s.levels,E.level=X,E.setMaxListeners=E.getMaxListeners=E.emit=E.addListener=E.on=E.prependListener=E.once=E.prependOnceListener=E.removeListener=E.removeAllListeners=E.listeners=E.listenerCount=E.eventNames=E.write=E.flush=N,E.serializers=R,E._serialize=F,E._stdErrSerialize=H,E.child=$,n&&(E._logEvent=O());function k(){return this.level==="silent"?1/0:this.levels.values[this.level]}function z(){return this._level}function L(U){if(U!=="silent"&&!this.levels.values[U])throw Error("unknown level "+U);this._level=U,c(C,E,"error","log"),c(C,E,"fatal","error"),c(C,E,"warn","error"),c(C,E,"info","log"),c(C,E,"debug","log"),c(C,E,"trace","log")}function $(U,q){if(!U)throw new Error("missing bindings for child Pino");q=q||{},F&&U.serializers&&(q.serializers=U.serializers);const te=q.serializers;if(F&&te){var B=Object.assign({},R,te),Z=f.browser.serialize===!0?Object.keys(B):F;delete U.serializers,h([U],Z,B,this._stdErrSerialize)}function Y(Q){this._childLevel=(Q._childLevel|0)+1,this.error=g(Q,U,"error"),this.fatal=g(Q,U,"fatal"),this.warn=g(Q,U,"warn"),this.info=g(Q,U,"info"),this.debug=g(Q,U,"debug"),this.trace=g(Q,U,"trace"),B&&(this.serializers=B,this._serialize=Z),n&&(this._logEvent=O([].concat(Q._logEvent.bindings,U)))}return Y.prototype=this,new Y(this)}return E}s.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},s.stdSerializers=t,s.stdTimeFunctions=Object.assign({},{nullTime:j,epochTime:_,unixTime:S,isoTime:p});function c(f,n,l,R){const F=Object.getPrototypeOf(n);n[l]=n.levelVal>n.levels.values[l]?N:F[l]?F[l]:e[l]||e[R]||N,u(f,n,l)}function u(f,n,l){!f.transmit&&n[l]===N||(n[l]=function(R){return function(){const H=f.timestamp(),V=new Array(arguments.length),X=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var E=0;E<V.length;E++)V[E]=arguments[E];if(f.serialize&&!f.asObject&&h(V,this._serialize,this.serializers,this._stdErrSerialize),f.asObject?R.call(X,o(this,l,V,H)):R.apply(X,V),f.transmit){const C=f.transmit.level||n.level,k=s.levels.values[C],z=s.levels.values[l];if(z<k)return;b(this,{ts:H,methodLevel:l,methodValue:z,transmitLevel:C,transmitValue:s.levels.values[f.transmit.level||n.level],send:f.transmit.send,val:n.levelVal},V)}}}(n[l]))}function o(f,n,l,R){f._serialize&&h(l,f._serialize,f.serializers,f._stdErrSerialize);const F=l.slice();let H=F[0];const V={};R&&(V.time=R),V.level=s.levels.values[n];let X=(f._childLevel|0)+1;if(X<1&&(X=1),H!==null&&typeof H=="object"){for(;X--&&typeof F[0]=="object";)Object.assign(V,F.shift());H=F.length?r(F.shift(),F):void 0}else typeof H=="string"&&(H=r(F.shift(),F));return H!==void 0&&(V.msg=H),V}function h(f,n,l,R){for(const F in f)if(R&&f[F]instanceof Error)f[F]=s.stdSerializers.err(f[F]);else if(typeof f[F]=="object"&&!Array.isArray(f[F]))for(const H in f[F])n&&n.indexOf(H)>-1&&H in l&&(f[F][H]=l[H](f[F][H]))}function g(f,n,l){return function(){const R=new Array(1+arguments.length);R[0]=n;for(var F=1;F<R.length;F++)R[F]=arguments[F-1];return f[l].apply(this,R)}}function b(f,n,l){const R=n.send,F=n.ts,H=n.methodLevel,V=n.methodValue,X=n.val,E=f._logEvent.bindings;h(l,f._serialize||Object.keys(f.serializers),f.serializers,f._stdErrSerialize===void 0?!0:f._stdErrSerialize),f._logEvent.ts=F,f._logEvent.messages=l.filter(function(C){return E.indexOf(C)===-1}),f._logEvent.level.label=H,f._logEvent.level.value=V,R(H,f._logEvent,X),f._logEvent=O(E)}function O(f){return{ts:0,messages:[],bindings:f||[],level:{label:"",value:0}}}function P(f){const n={type:f.constructor.name,msg:f.message,stack:f.stack};for(const l in f)n[l]===void 0&&(n[l]=f[l]);return n}function D(f){return typeof f.timestamp=="function"?f.timestamp:f.timestamp===!1?j:_}function A(){return{}}function T(f){return f}function N(){}function j(){return!1}function _(){return Date.now()}function S(){return Math.round(Date.now()/1e3)}function p(){return new Date(Date.now()).toISOString()}function w(){function f(n){return typeof n<"u"&&n}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return f(self)||f(window)||f(this)||{}}}return ti}var Fo=Nn();const Hr=So(Fo);var Kr={},yr={};Object.defineProperty(yr,"__esModule",{value:!0});function Uo(r){if(typeof r!="string")throw new Error(`Cannot safe json parse value of type ${typeof r}`);try{return JSON.parse(r)}catch{return r}}yr.safeJsonParse=Uo;function Lo(r){return typeof r=="string"?r:JSON.stringify(r,(e,t)=>typeof t>"u"?null:t)}yr.safeJsonStringify=Lo;var Ur={},ri={get exports(){return Ur},set exports(r){Ur=r}},ds;function Mo(){return ds||(ds=1,function(){let r;function e(){}r=e,r.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},r.prototype.setItem=function(t,i){this[t]=String(i)},r.prototype.removeItem=function(t){delete this[t]},r.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(i){t[i]=void 0,delete t[i]})},r.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},r.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof kt<"u"&&kt.localStorage?ri.exports=kt.localStorage:typeof window<"u"&&window.localStorage?ri.exports=window.localStorage:ri.exports=new e}()),Ur}var ii={},nr={},ps;function $o(){if(ps)return nr;ps=1,Object.defineProperty(nr,"__esModule",{value:!0}),nr.IKeyValueStorage=void 0;class r{}return nr.IKeyValueStorage=r,nr}var ar={},gs;function jo(){if(gs)return ar;gs=1,Object.defineProperty(ar,"__esModule",{value:!0}),ar.parseEntry=void 0;const r=yr;function e(t){var i;return[t[0],r.safeJsonParse((i=t[1])!==null&&i!==void 0?i:"")]}return ar.parseEntry=e,ar}var ys;function zo(){return ys||(ys=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=wt;e.__exportStar($o(),r),e.__exportStar(jo(),r)}(ii)),ii}Object.defineProperty(Kr,"__esModule",{value:!0});Kr.KeyValueStorage=void 0;const Qt=wt,bs=yr,qo=Qt.__importDefault(Mo()),Bo=zo();class Rn{constructor(){this.localStorage=qo.default}getKeys(){return Qt.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return Qt.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(Bo.parseEntry)})}getItem(e){return Qt.__awaiter(this,void 0,void 0,function*(){const t=this.localStorage.getItem(e);if(t!==null)return bs.safeJsonParse(t)})}setItem(e,t){return Qt.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(e,bs.safeJsonStringify(t))})}removeItem(e){return Qt.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(e)})}}Kr.KeyValueStorage=Rn;var Ho=Kr.default=Rn,br={},or={},ee={},si={},cr={},ws;function Ko(){if(ws)return cr;ws=1,Object.defineProperty(cr,"__esModule",{value:!0}),cr.delay=void 0;function r(e){return new Promise(t=>{setTimeout(()=>{t(!0)},e)})}return cr.delay=r,cr}var Bt={},ni={},Ht={},_s;function Vo(){return _s||(_s=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.ONE_THOUSAND=Ht.ONE_HUNDRED=void 0,Ht.ONE_HUNDRED=100,Ht.ONE_THOUSAND=1e3),Ht}var ai={},ms;function Go(){return ms||(ms=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ONE_YEAR=r.FOUR_WEEKS=r.THREE_WEEKS=r.TWO_WEEKS=r.ONE_WEEK=r.THIRTY_DAYS=r.SEVEN_DAYS=r.FIVE_DAYS=r.THREE_DAYS=r.ONE_DAY=r.TWENTY_FOUR_HOURS=r.TWELVE_HOURS=r.SIX_HOURS=r.THREE_HOURS=r.ONE_HOUR=r.SIXTY_MINUTES=r.THIRTY_MINUTES=r.TEN_MINUTES=r.FIVE_MINUTES=r.ONE_MINUTE=r.SIXTY_SECONDS=r.THIRTY_SECONDS=r.TEN_SECONDS=r.FIVE_SECONDS=r.ONE_SECOND=void 0,r.ONE_SECOND=1,r.FIVE_SECONDS=5,r.TEN_SECONDS=10,r.THIRTY_SECONDS=30,r.SIXTY_SECONDS=60,r.ONE_MINUTE=r.SIXTY_SECONDS,r.FIVE_MINUTES=r.ONE_MINUTE*5,r.TEN_MINUTES=r.ONE_MINUTE*10,r.THIRTY_MINUTES=r.ONE_MINUTE*30,r.SIXTY_MINUTES=r.ONE_MINUTE*60,r.ONE_HOUR=r.SIXTY_MINUTES,r.THREE_HOURS=r.ONE_HOUR*3,r.SIX_HOURS=r.ONE_HOUR*6,r.TWELVE_HOURS=r.ONE_HOUR*12,r.TWENTY_FOUR_HOURS=r.ONE_HOUR*24,r.ONE_DAY=r.TWENTY_FOUR_HOURS,r.THREE_DAYS=r.ONE_DAY*3,r.FIVE_DAYS=r.ONE_DAY*5,r.SEVEN_DAYS=r.ONE_DAY*7,r.THIRTY_DAYS=r.ONE_DAY*30,r.ONE_WEEK=r.SEVEN_DAYS,r.TWO_WEEKS=r.ONE_WEEK*2,r.THREE_WEEKS=r.ONE_WEEK*3,r.FOUR_WEEKS=r.ONE_WEEK*4,r.ONE_YEAR=r.ONE_DAY*365}(ai)),ai}var vs;function Fn(){return vs||(vs=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=wt;e.__exportStar(Vo(),r),e.__exportStar(Go(),r)}(ni)),ni}var Es;function ko(){if(Es)return Bt;Es=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.fromMiliseconds=Bt.toMiliseconds=void 0;const r=Fn();function e(i){return i*r.ONE_THOUSAND}Bt.toMiliseconds=e;function t(i){return Math.floor(i/r.ONE_THOUSAND)}return Bt.fromMiliseconds=t,Bt}var Ds;function Wo(){return Ds||(Ds=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=wt;e.__exportStar(Ko(),r),e.__exportStar(ko(),r)}(si)),si}var Zt={},Ss;function Yo(){if(Ss)return Zt;Ss=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.Watch=void 0;class r{constructor(){this.timestamps=new Map}start(t){if(this.timestamps.has(t))throw new Error(`Watch already started for label: ${t}`);this.timestamps.set(t,{started:Date.now()})}stop(t){const i=this.get(t);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${t}`);const s=Date.now()-i.started;this.timestamps.set(t,{started:i.started,elapsed:s})}get(t){const i=this.timestamps.get(t);if(typeof i>"u")throw new Error(`No timestamp found for label: ${t}`);return i}elapsed(t){const i=this.get(t);return i.elapsed||Date.now()-i.started}}return Zt.Watch=r,Zt.default=r,Zt}var oi={},hr={},xs;function Jo(){if(xs)return hr;xs=1,Object.defineProperty(hr,"__esModule",{value:!0}),hr.IWatch=void 0;class r{}return hr.IWatch=r,hr}var Is;function Xo(){return Is||(Is=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),wt.__exportStar(Jo(),r)}(oi)),oi}(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=wt;e.__exportStar(Wo(),r),e.__exportStar(Yo(),r),e.__exportStar(Xo(),r),e.__exportStar(Fn(),r)})(ee);var ci={},ur={};class Wt{}const Zo=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Wt},Symbol.toStringTag,{value:"Module"})),Qo=xo(Zo);var Os;function ec(){if(Os)return ur;Os=1,Object.defineProperty(ur,"__esModule",{value:!0}),ur.IHeartBeat=void 0;const r=Qo;class e extends r.IEvents{constructor(i){super()}}return ur.IHeartBeat=e,ur}var As;function Un(){return As||(As=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),wt.__exportStar(ec(),r)}(ci)),ci}var hi={},Kt={},Cs;function tc(){if(Cs)return Kt;Cs=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.HEARTBEAT_EVENTS=Kt.HEARTBEAT_INTERVAL=void 0;const r=ee;return Kt.HEARTBEAT_INTERVAL=r.FIVE_SECONDS,Kt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Kt}var Ps;function Ln(){return Ps||(Ps=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),wt.__exportStar(tc(),r)}(hi)),hi}var Ts;function rc(){if(Ts)return or;Ts=1,Object.defineProperty(or,"__esModule",{value:!0}),or.HeartBeat=void 0;const r=wt,e=dt,t=ee,i=Un(),s=Ln();class c extends i.IHeartBeat{constructor(o){super(o),this.events=new e.EventEmitter,this.interval=s.HEARTBEAT_INTERVAL,this.interval=(o==null?void 0:o.interval)||s.HEARTBEAT_INTERVAL}static init(o){return r.__awaiter(this,void 0,void 0,function*(){const h=new c(o);return yield h.init(),h})}init(){return r.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(o,h){this.events.on(o,h)}once(o,h){this.events.once(o,h)}off(o,h){this.events.off(o,h)}removeListener(o,h){this.events.removeListener(o,h)}initialize(){return r.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),t.toMiliseconds(this.interval))})}pulse(){this.events.emit(s.HEARTBEAT_EVENTS.pulse)}}return or.HeartBeat=c,or}(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=wt;e.__exportStar(rc(),r),e.__exportStar(Un(),r),e.__exportStar(Ln(),r)})(br);var Se={},Vt={},Ns;function Mn(){return Ns||(Ns=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.PINO_CUSTOM_CONTEXT_KEY=Vt.PINO_LOGGER_DEFAULTS=void 0,Vt.PINO_LOGGER_DEFAULTS={level:"info"},Vt.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Vt}var it={},Rs;function ic(){if(Rs)return it;Rs=1,Object.defineProperty(it,"__esModule",{value:!0}),it.generateChildLogger=it.formatChildLoggerContext=it.getLoggerContext=it.setBrowserLoggerContext=it.getBrowserLoggerContext=it.getDefaultLoggerOptions=void 0;const r=Mn();function e(o){return Object.assign(Object.assign({},o),{level:(o==null?void 0:o.level)||r.PINO_LOGGER_DEFAULTS.level})}it.getDefaultLoggerOptions=e;function t(o,h=r.PINO_CUSTOM_CONTEXT_KEY){return o[h]||""}it.getBrowserLoggerContext=t;function i(o,h,g=r.PINO_CUSTOM_CONTEXT_KEY){return o[g]=h,o}it.setBrowserLoggerContext=i;function s(o,h=r.PINO_CUSTOM_CONTEXT_KEY){let g="";return typeof o.bindings>"u"?g=t(o,h):g=o.bindings().context||"",g}it.getLoggerContext=s;function c(o,h,g=r.PINO_CUSTOM_CONTEXT_KEY){const b=s(o,g);return b.trim()?`${b}/${h}`:h}it.formatChildLoggerContext=c;function u(o,h,g=r.PINO_CUSTOM_CONTEXT_KEY){const b=c(o,h,g),O=o.child({context:b});return i(O,b,g)}return it.generateChildLogger=u,it}(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.pino=void 0;const e=wt,t=e.__importDefault(Nn());Object.defineProperty(r,"pino",{enumerable:!0,get:function(){return t.default}}),e.__exportStar(Mn(),r),e.__exportStar(ic(),r)})(Se);class sc extends Wt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}let nc=class extends Wt{constructor(e,t){super(),this.core=e,this.logger=t,this.records=new Map}},ac=class{constructor(e,t){this.logger=e,this.core=t}},oc=class extends Wt{constructor(e,t){super(),this.relayer=e,this.logger=t}};class cc extends Wt{constructor(e){super()}}let hc=class{constructor(e,t,i,s){this.core=e,this.logger=t,this.name=i}};class uc extends Wt{constructor(e,t){super(),this.relayer=e,this.logger=t}}let lc=class extends Wt{constructor(e,t){super(),this.core=e,this.logger=t}},fc=class{constructor(e){this.opts=e,this.protocol="wc",this.version=2}},dc=class{constructor(e){this.client=e}};var Ui={},er={},Vr={},Gr={};Object.defineProperty(Gr,"__esModule",{value:!0});Gr.BrowserRandomSource=void 0;const Fs=65536;class pc{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const t=new Uint8Array(e);for(let i=0;i<t.length;i+=Fs)this._crypto.getRandomValues(t.subarray(i,i+Math.min(t.length-i,Fs)));return t}}Gr.BrowserRandomSource=pc;function gc(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var kr={},ct={};Object.defineProperty(ct,"__esModule",{value:!0});function yc(r){for(var e=0;e<r.length;e++)r[e]=0;return r}ct.wipe=yc;Object.defineProperty(kr,"__esModule",{value:!0});kr.NodeRandomSource=void 0;const bc=ct;class wc{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof gc<"u"){const e=Io;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let t=this._crypto.randomBytes(e);if(t.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const i=new Uint8Array(e);for(let s=0;s<i.length;s++)i[s]=t[s];return(0,bc.wipe)(t),i}}kr.NodeRandomSource=wc;Object.defineProperty(Vr,"__esModule",{value:!0});Vr.SystemRandomSource=void 0;const _c=Gr,mc=kr;class vc{constructor(){if(this.isAvailable=!1,this.name="",this._source=new _c.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new mc.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}Vr.SystemRandomSource=vc;var se={},$n={};(function(r){Object.defineProperty(r,"__esModule",{value:!0});function e(o,h){var g=o>>>16&65535,b=o&65535,O=h>>>16&65535,P=h&65535;return b*P+(g*P+b*O<<16>>>0)|0}r.mul=Math.imul||e;function t(o,h){return o+h|0}r.add=t;function i(o,h){return o-h|0}r.sub=i;function s(o,h){return o<<h|o>>>32-h}r.rotl=s;function c(o,h){return o<<32-h|o>>>h}r.rotr=c;function u(o){return typeof o=="number"&&isFinite(o)&&Math.floor(o)===o}r.isInteger=Number.isInteger||u,r.MAX_SAFE_INTEGER=9007199254740991,r.isSafeInteger=function(o){return r.isInteger(o)&&o>=-r.MAX_SAFE_INTEGER&&o<=r.MAX_SAFE_INTEGER}})($n);Object.defineProperty(se,"__esModule",{value:!0});var jn=$n;function Ec(r,e){return e===void 0&&(e=0),(r[e+0]<<8|r[e+1])<<16>>16}se.readInt16BE=Ec;function Dc(r,e){return e===void 0&&(e=0),(r[e+0]<<8|r[e+1])>>>0}se.readUint16BE=Dc;function Sc(r,e){return e===void 0&&(e=0),(r[e+1]<<8|r[e])<<16>>16}se.readInt16LE=Sc;function xc(r,e){return e===void 0&&(e=0),(r[e+1]<<8|r[e])>>>0}se.readUint16LE=xc;function zn(r,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=r>>>8,e[t+1]=r>>>0,e}se.writeUint16BE=zn;se.writeInt16BE=zn;function qn(r,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=r>>>0,e[t+1]=r>>>8,e}se.writeUint16LE=qn;se.writeInt16LE=qn;function bi(r,e){return e===void 0&&(e=0),r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}se.readInt32BE=bi;function wi(r,e){return e===void 0&&(e=0),(r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3])>>>0}se.readUint32BE=wi;function _i(r,e){return e===void 0&&(e=0),r[e+3]<<24|r[e+2]<<16|r[e+1]<<8|r[e]}se.readInt32LE=_i;function mi(r,e){return e===void 0&&(e=0),(r[e+3]<<24|r[e+2]<<16|r[e+1]<<8|r[e])>>>0}se.readUint32LE=mi;function Lr(r,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=r>>>24,e[t+1]=r>>>16,e[t+2]=r>>>8,e[t+3]=r>>>0,e}se.writeUint32BE=Lr;se.writeInt32BE=Lr;function Mr(r,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=r>>>0,e[t+1]=r>>>8,e[t+2]=r>>>16,e[t+3]=r>>>24,e}se.writeUint32LE=Mr;se.writeInt32LE=Mr;function Ic(r,e){e===void 0&&(e=0);var t=bi(r,e),i=bi(r,e+4);return t*4294967296+i-(i>>31)*4294967296}se.readInt64BE=Ic;function Oc(r,e){e===void 0&&(e=0);var t=wi(r,e),i=wi(r,e+4);return t*4294967296+i}se.readUint64BE=Oc;function Ac(r,e){e===void 0&&(e=0);var t=_i(r,e),i=_i(r,e+4);return i*4294967296+t-(t>>31)*4294967296}se.readInt64LE=Ac;function Cc(r,e){e===void 0&&(e=0);var t=mi(r,e),i=mi(r,e+4);return i*4294967296+t}se.readUint64LE=Cc;function Bn(r,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),Lr(r/4294967296>>>0,e,t),Lr(r>>>0,e,t+4),e}se.writeUint64BE=Bn;se.writeInt64BE=Bn;function Hn(r,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),Mr(r>>>0,e,t),Mr(r/4294967296>>>0,e,t+4),e}se.writeUint64LE=Hn;se.writeInt64LE=Hn;function Pc(r,e,t){if(t===void 0&&(t=0),r%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(r/8>e.length-t)throw new Error("readUintBE: array is too short for the given bitLength");for(var i=0,s=1,c=r/8+t-1;c>=t;c--)i+=e[c]*s,s*=256;return i}se.readUintBE=Pc;function Tc(r,e,t){if(t===void 0&&(t=0),r%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(r/8>e.length-t)throw new Error("readUintLE: array is too short for the given bitLength");for(var i=0,s=1,c=t;c<t+r/8;c++)i+=e[c]*s,s*=256;return i}se.readUintLE=Tc;function Nc(r,e,t,i){if(t===void 0&&(t=new Uint8Array(r/8)),i===void 0&&(i=0),r%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!jn.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var s=1,c=r/8+i-1;c>=i;c--)t[c]=e/s&255,s*=256;return t}se.writeUintBE=Nc;function Rc(r,e,t,i){if(t===void 0&&(t=new Uint8Array(r/8)),i===void 0&&(i=0),r%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!jn.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var s=1,c=i;c<i+r/8;c++)t[c]=e/s&255,s*=256;return t}se.writeUintLE=Rc;function Fc(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat32(e)}se.readFloat32BE=Fc;function Uc(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat32(e,!0)}se.readFloat32LE=Uc;function Lc(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat64(e)}se.readFloat64BE=Lc;function Mc(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat64(e,!0)}se.readFloat64LE=Mc;function $c(r,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(t,r),e}se.writeFloat32BE=$c;function jc(r,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(t,r,!0),e}se.writeFloat32LE=jc;function zc(r,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(t,r),e}se.writeFloat64BE=zc;function qc(r,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(t,r,!0),e}se.writeFloat64LE=qc;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.randomStringForEntropy=r.randomString=r.randomUint32=r.randomBytes=r.defaultRandomSource=void 0;const e=Vr,t=se,i=ct;r.defaultRandomSource=new e.SystemRandomSource;function s(g,b=r.defaultRandomSource){return b.randomBytes(g)}r.randomBytes=s;function c(g=r.defaultRandomSource){const b=s(4,g),O=(0,t.readUint32LE)(b);return(0,i.wipe)(b),O}r.randomUint32=c;const u="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function o(g,b=u,O=r.defaultRandomSource){if(b.length<2)throw new Error("randomString charset is too short");if(b.length>256)throw new Error("randomString charset is too long");let P="";const D=b.length,A=256-256%D;for(;g>0;){const T=s(Math.ceil(g*256/A),O);for(let N=0;N<T.length&&g>0;N++){const j=T[N];j<A&&(P+=b.charAt(j%D),g--)}(0,i.wipe)(T)}return P}r.randomString=o;function h(g,b=u,O=r.defaultRandomSource){const P=Math.ceil(g/(Math.log(b.length)/Math.LN2));return o(P,b,O)}r.randomStringForEntropy=h})(er);var Kn={};(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=se,t=ct;r.DIGEST_LENGTH=64,r.BLOCK_SIZE=128;var i=function(){function o(){this.digestLength=r.DIGEST_LENGTH,this.blockSize=r.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return o.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},o.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},o.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._tempHi),t.wipe(this._tempLo),this.reset()},o.prototype.update=function(h,g){if(g===void 0&&(g=h.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var b=0;if(this._bytesHashed+=g,this._bufferLength>0){for(;this._bufferLength<r.BLOCK_SIZE&&g>0;)this._buffer[this._bufferLength++]=h[b++],g--;this._bufferLength===this.blockSize&&(c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(g>=this.blockSize&&(b=c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,h,b,g),g%=this.blockSize);g>0;)this._buffer[this._bufferLength++]=h[b++],g--;return this},o.prototype.finish=function(h){if(!this._finished){var g=this._bytesHashed,b=this._bufferLength,O=g/536870912|0,P=g<<3,D=g%128<112?128:256;this._buffer[b]=128;for(var A=b+1;A<D-8;A++)this._buffer[A]=0;e.writeUint32BE(O,this._buffer,D-8),e.writeUint32BE(P,this._buffer,D-4),c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,D),this._finished=!0}for(var A=0;A<this.digestLength/8;A++)e.writeUint32BE(this._stateHi[A],h,A*8),e.writeUint32BE(this._stateLo[A],h,A*8+4);return this},o.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},o.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},o.prototype.restoreState=function(h){return this._stateHi.set(h.stateHi),this._stateLo.set(h.stateLo),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},o.prototype.cleanSavedState=function(h){t.wipe(h.stateHi),t.wipe(h.stateLo),h.buffer&&t.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},o}();r.SHA512=i;var s=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function c(o,h,g,b,O,P,D){for(var A=g[0],T=g[1],N=g[2],j=g[3],_=g[4],S=g[5],p=g[6],w=g[7],f=b[0],n=b[1],l=b[2],R=b[3],F=b[4],H=b[5],V=b[6],X=b[7],E,C,k,z,L,$,U,q;D>=128;){for(var te=0;te<16;te++){var B=8*te+P;o[te]=e.readUint32BE(O,B),h[te]=e.readUint32BE(O,B+4)}for(var te=0;te<80;te++){var Z=A,Y=T,Q=N,I=j,x=_,m=S,a=p,y=w,K=f,W=n,le=l,be=R,de=F,me=H,Re=V,Ce=X;if(E=w,C=X,L=C&65535,$=C>>>16,U=E&65535,q=E>>>16,E=(_>>>14|F<<32-14)^(_>>>18|F<<32-18)^(F>>>41-32|_<<32-(41-32)),C=(F>>>14|_<<32-14)^(F>>>18|_<<32-18)^(_>>>41-32|F<<32-(41-32)),L+=C&65535,$+=C>>>16,U+=E&65535,q+=E>>>16,E=_&S^~_&p,C=F&H^~F&V,L+=C&65535,$+=C>>>16,U+=E&65535,q+=E>>>16,E=s[te*2],C=s[te*2+1],L+=C&65535,$+=C>>>16,U+=E&65535,q+=E>>>16,E=o[te%16],C=h[te%16],L+=C&65535,$+=C>>>16,U+=E&65535,q+=E>>>16,$+=L>>>16,U+=$>>>16,q+=U>>>16,k=U&65535|q<<16,z=L&65535|$<<16,E=k,C=z,L=C&65535,$=C>>>16,U=E&65535,q=E>>>16,E=(A>>>28|f<<32-28)^(f>>>34-32|A<<32-(34-32))^(f>>>39-32|A<<32-(39-32)),C=(f>>>28|A<<32-28)^(A>>>34-32|f<<32-(34-32))^(A>>>39-32|f<<32-(39-32)),L+=C&65535,$+=C>>>16,U+=E&65535,q+=E>>>16,E=A&T^A&N^T&N,C=f&n^f&l^n&l,L+=C&65535,$+=C>>>16,U+=E&65535,q+=E>>>16,$+=L>>>16,U+=$>>>16,q+=U>>>16,y=U&65535|q<<16,Ce=L&65535|$<<16,E=I,C=be,L=C&65535,$=C>>>16,U=E&65535,q=E>>>16,E=k,C=z,L+=C&65535,$+=C>>>16,U+=E&65535,q+=E>>>16,$+=L>>>16,U+=$>>>16,q+=U>>>16,I=U&65535|q<<16,be=L&65535|$<<16,T=Z,N=Y,j=Q,_=I,S=x,p=m,w=a,A=y,n=K,l=W,R=le,F=be,H=de,V=me,X=Re,f=Ce,te%16===15)for(var B=0;B<16;B++)E=o[B],C=h[B],L=C&65535,$=C>>>16,U=E&65535,q=E>>>16,E=o[(B+9)%16],C=h[(B+9)%16],L+=C&65535,$+=C>>>16,U+=E&65535,q+=E>>>16,k=o[(B+1)%16],z=h[(B+1)%16],E=(k>>>1|z<<32-1)^(k>>>8|z<<32-8)^k>>>7,C=(z>>>1|k<<32-1)^(z>>>8|k<<32-8)^(z>>>7|k<<32-7),L+=C&65535,$+=C>>>16,U+=E&65535,q+=E>>>16,k=o[(B+14)%16],z=h[(B+14)%16],E=(k>>>19|z<<32-19)^(z>>>61-32|k<<32-(61-32))^k>>>6,C=(z>>>19|k<<32-19)^(k>>>61-32|z<<32-(61-32))^(z>>>6|k<<32-6),L+=C&65535,$+=C>>>16,U+=E&65535,q+=E>>>16,$+=L>>>16,U+=$>>>16,q+=U>>>16,o[B]=U&65535|q<<16,h[B]=L&65535|$<<16}E=A,C=f,L=C&65535,$=C>>>16,U=E&65535,q=E>>>16,E=g[0],C=b[0],L+=C&65535,$+=C>>>16,U+=E&65535,q+=E>>>16,$+=L>>>16,U+=$>>>16,q+=U>>>16,g[0]=A=U&65535|q<<16,b[0]=f=L&65535|$<<16,E=T,C=n,L=C&65535,$=C>>>16,U=E&65535,q=E>>>16,E=g[1],C=b[1],L+=C&65535,$+=C>>>16,U+=E&65535,q+=E>>>16,$+=L>>>16,U+=$>>>16,q+=U>>>16,g[1]=T=U&65535|q<<16,b[1]=n=L&65535|$<<16,E=N,C=l,L=C&65535,$=C>>>16,U=E&65535,q=E>>>16,E=g[2],C=b[2],L+=C&65535,$+=C>>>16,U+=E&65535,q+=E>>>16,$+=L>>>16,U+=$>>>16,q+=U>>>16,g[2]=N=U&65535|q<<16,b[2]=l=L&65535|$<<16,E=j,C=R,L=C&65535,$=C>>>16,U=E&65535,q=E>>>16,E=g[3],C=b[3],L+=C&65535,$+=C>>>16,U+=E&65535,q+=E>>>16,$+=L>>>16,U+=$>>>16,q+=U>>>16,g[3]=j=U&65535|q<<16,b[3]=R=L&65535|$<<16,E=_,C=F,L=C&65535,$=C>>>16,U=E&65535,q=E>>>16,E=g[4],C=b[4],L+=C&65535,$+=C>>>16,U+=E&65535,q+=E>>>16,$+=L>>>16,U+=$>>>16,q+=U>>>16,g[4]=_=U&65535|q<<16,b[4]=F=L&65535|$<<16,E=S,C=H,L=C&65535,$=C>>>16,U=E&65535,q=E>>>16,E=g[5],C=b[5],L+=C&65535,$+=C>>>16,U+=E&65535,q+=E>>>16,$+=L>>>16,U+=$>>>16,q+=U>>>16,g[5]=S=U&65535|q<<16,b[5]=H=L&65535|$<<16,E=p,C=V,L=C&65535,$=C>>>16,U=E&65535,q=E>>>16,E=g[6],C=b[6],L+=C&65535,$+=C>>>16,U+=E&65535,q+=E>>>16,$+=L>>>16,U+=$>>>16,q+=U>>>16,g[6]=p=U&65535|q<<16,b[6]=V=L&65535|$<<16,E=w,C=X,L=C&65535,$=C>>>16,U=E&65535,q=E>>>16,E=g[7],C=b[7],L+=C&65535,$+=C>>>16,U+=E&65535,q+=E>>>16,$+=L>>>16,U+=$>>>16,q+=U>>>16,g[7]=w=U&65535|q<<16,b[7]=X=L&65535|$<<16,P+=128,D-=128}return P}function u(o){var h=new i;h.update(o);var g=h.digest();return h.clean(),g}r.hash=u})(Kn);(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.convertSecretKeyToX25519=r.convertPublicKeyToX25519=r.verify=r.sign=r.extractPublicKeyFromSecretKey=r.generateKeyPair=r.generateKeyPairFromSeed=r.SEED_LENGTH=r.SECRET_KEY_LENGTH=r.PUBLIC_KEY_LENGTH=r.SIGNATURE_LENGTH=void 0;const e=er,t=Kn,i=ct;r.SIGNATURE_LENGTH=64,r.PUBLIC_KEY_LENGTH=32,r.SECRET_KEY_LENGTH=64,r.SEED_LENGTH=32;function s(I){const x=new Float64Array(16);if(I)for(let m=0;m<I.length;m++)x[m]=I[m];return x}const c=new Uint8Array(32);c[0]=9;const u=s(),o=s([1]),h=s([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),g=s([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),b=s([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),O=s([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),P=s([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function D(I,x){for(let m=0;m<16;m++)I[m]=x[m]|0}function A(I){let x=1;for(let m=0;m<16;m++){let a=I[m]+x+65535;x=Math.floor(a/65536),I[m]=a-x*65536}I[0]+=x-1+37*(x-1)}function T(I,x,m){const a=~(m-1);for(let y=0;y<16;y++){const K=a&(I[y]^x[y]);I[y]^=K,x[y]^=K}}function N(I,x){const m=s(),a=s();for(let y=0;y<16;y++)a[y]=x[y];A(a),A(a),A(a);for(let y=0;y<2;y++){m[0]=a[0]-65517;for(let W=1;W<15;W++)m[W]=a[W]-65535-(m[W-1]>>16&1),m[W-1]&=65535;m[15]=a[15]-32767-(m[14]>>16&1);const K=m[15]>>16&1;m[14]&=65535,T(a,m,1-K)}for(let y=0;y<16;y++)I[2*y]=a[y]&255,I[2*y+1]=a[y]>>8}function j(I,x){let m=0;for(let a=0;a<32;a++)m|=I[a]^x[a];return(1&m-1>>>8)-1}function _(I,x){const m=new Uint8Array(32),a=new Uint8Array(32);return N(m,I),N(a,x),j(m,a)}function S(I){const x=new Uint8Array(32);return N(x,I),x[0]&1}function p(I,x){for(let m=0;m<16;m++)I[m]=x[2*m]+(x[2*m+1]<<8);I[15]&=32767}function w(I,x,m){for(let a=0;a<16;a++)I[a]=x[a]+m[a]}function f(I,x,m){for(let a=0;a<16;a++)I[a]=x[a]-m[a]}function n(I,x,m){let a,y,K=0,W=0,le=0,be=0,de=0,me=0,Re=0,Ce=0,ye=0,pe=0,fe=0,he=0,ce=0,oe=0,ae=0,re=0,ue=0,ge=0,ie=0,we=0,_e=0,Ee=0,De=0,ve=0,pt=0,_t=0,At=0,at=0,$t=0,rr=0,Sr=0,Ue=m[0],Pe=m[1],Le=m[2],Me=m[3],$e=m[4],Te=m[5],Be=m[6],He=m[7],Ke=m[8],Ve=m[9],Ge=m[10],ze=m[11],je=m[12],Oe=m[13],ke=m[14],We=m[15];a=x[0],K+=a*Ue,W+=a*Pe,le+=a*Le,be+=a*Me,de+=a*$e,me+=a*Te,Re+=a*Be,Ce+=a*He,ye+=a*Ke,pe+=a*Ve,fe+=a*Ge,he+=a*ze,ce+=a*je,oe+=a*Oe,ae+=a*ke,re+=a*We,a=x[1],W+=a*Ue,le+=a*Pe,be+=a*Le,de+=a*Me,me+=a*$e,Re+=a*Te,Ce+=a*Be,ye+=a*He,pe+=a*Ke,fe+=a*Ve,he+=a*Ge,ce+=a*ze,oe+=a*je,ae+=a*Oe,re+=a*ke,ue+=a*We,a=x[2],le+=a*Ue,be+=a*Pe,de+=a*Le,me+=a*Me,Re+=a*$e,Ce+=a*Te,ye+=a*Be,pe+=a*He,fe+=a*Ke,he+=a*Ve,ce+=a*Ge,oe+=a*ze,ae+=a*je,re+=a*Oe,ue+=a*ke,ge+=a*We,a=x[3],be+=a*Ue,de+=a*Pe,me+=a*Le,Re+=a*Me,Ce+=a*$e,ye+=a*Te,pe+=a*Be,fe+=a*He,he+=a*Ke,ce+=a*Ve,oe+=a*Ge,ae+=a*ze,re+=a*je,ue+=a*Oe,ge+=a*ke,ie+=a*We,a=x[4],de+=a*Ue,me+=a*Pe,Re+=a*Le,Ce+=a*Me,ye+=a*$e,pe+=a*Te,fe+=a*Be,he+=a*He,ce+=a*Ke,oe+=a*Ve,ae+=a*Ge,re+=a*ze,ue+=a*je,ge+=a*Oe,ie+=a*ke,we+=a*We,a=x[5],me+=a*Ue,Re+=a*Pe,Ce+=a*Le,ye+=a*Me,pe+=a*$e,fe+=a*Te,he+=a*Be,ce+=a*He,oe+=a*Ke,ae+=a*Ve,re+=a*Ge,ue+=a*ze,ge+=a*je,ie+=a*Oe,we+=a*ke,_e+=a*We,a=x[6],Re+=a*Ue,Ce+=a*Pe,ye+=a*Le,pe+=a*Me,fe+=a*$e,he+=a*Te,ce+=a*Be,oe+=a*He,ae+=a*Ke,re+=a*Ve,ue+=a*Ge,ge+=a*ze,ie+=a*je,we+=a*Oe,_e+=a*ke,Ee+=a*We,a=x[7],Ce+=a*Ue,ye+=a*Pe,pe+=a*Le,fe+=a*Me,he+=a*$e,ce+=a*Te,oe+=a*Be,ae+=a*He,re+=a*Ke,ue+=a*Ve,ge+=a*Ge,ie+=a*ze,we+=a*je,_e+=a*Oe,Ee+=a*ke,De+=a*We,a=x[8],ye+=a*Ue,pe+=a*Pe,fe+=a*Le,he+=a*Me,ce+=a*$e,oe+=a*Te,ae+=a*Be,re+=a*He,ue+=a*Ke,ge+=a*Ve,ie+=a*Ge,we+=a*ze,_e+=a*je,Ee+=a*Oe,De+=a*ke,ve+=a*We,a=x[9],pe+=a*Ue,fe+=a*Pe,he+=a*Le,ce+=a*Me,oe+=a*$e,ae+=a*Te,re+=a*Be,ue+=a*He,ge+=a*Ke,ie+=a*Ve,we+=a*Ge,_e+=a*ze,Ee+=a*je,De+=a*Oe,ve+=a*ke,pt+=a*We,a=x[10],fe+=a*Ue,he+=a*Pe,ce+=a*Le,oe+=a*Me,ae+=a*$e,re+=a*Te,ue+=a*Be,ge+=a*He,ie+=a*Ke,we+=a*Ve,_e+=a*Ge,Ee+=a*ze,De+=a*je,ve+=a*Oe,pt+=a*ke,_t+=a*We,a=x[11],he+=a*Ue,ce+=a*Pe,oe+=a*Le,ae+=a*Me,re+=a*$e,ue+=a*Te,ge+=a*Be,ie+=a*He,we+=a*Ke,_e+=a*Ve,Ee+=a*Ge,De+=a*ze,ve+=a*je,pt+=a*Oe,_t+=a*ke,At+=a*We,a=x[12],ce+=a*Ue,oe+=a*Pe,ae+=a*Le,re+=a*Me,ue+=a*$e,ge+=a*Te,ie+=a*Be,we+=a*He,_e+=a*Ke,Ee+=a*Ve,De+=a*Ge,ve+=a*ze,pt+=a*je,_t+=a*Oe,At+=a*ke,at+=a*We,a=x[13],oe+=a*Ue,ae+=a*Pe,re+=a*Le,ue+=a*Me,ge+=a*$e,ie+=a*Te,we+=a*Be,_e+=a*He,Ee+=a*Ke,De+=a*Ve,ve+=a*Ge,pt+=a*ze,_t+=a*je,At+=a*Oe,at+=a*ke,$t+=a*We,a=x[14],ae+=a*Ue,re+=a*Pe,ue+=a*Le,ge+=a*Me,ie+=a*$e,we+=a*Te,_e+=a*Be,Ee+=a*He,De+=a*Ke,ve+=a*Ve,pt+=a*Ge,_t+=a*ze,At+=a*je,at+=a*Oe,$t+=a*ke,rr+=a*We,a=x[15],re+=a*Ue,ue+=a*Pe,ge+=a*Le,ie+=a*Me,we+=a*$e,_e+=a*Te,Ee+=a*Be,De+=a*He,ve+=a*Ke,pt+=a*Ve,_t+=a*Ge,At+=a*ze,at+=a*je,$t+=a*Oe,rr+=a*ke,Sr+=a*We,K+=38*ue,W+=38*ge,le+=38*ie,be+=38*we,de+=38*_e,me+=38*Ee,Re+=38*De,Ce+=38*ve,ye+=38*pt,pe+=38*_t,fe+=38*At,he+=38*at,ce+=38*$t,oe+=38*rr,ae+=38*Sr,y=1,a=K+y+65535,y=Math.floor(a/65536),K=a-y*65536,a=W+y+65535,y=Math.floor(a/65536),W=a-y*65536,a=le+y+65535,y=Math.floor(a/65536),le=a-y*65536,a=be+y+65535,y=Math.floor(a/65536),be=a-y*65536,a=de+y+65535,y=Math.floor(a/65536),de=a-y*65536,a=me+y+65535,y=Math.floor(a/65536),me=a-y*65536,a=Re+y+65535,y=Math.floor(a/65536),Re=a-y*65536,a=Ce+y+65535,y=Math.floor(a/65536),Ce=a-y*65536,a=ye+y+65535,y=Math.floor(a/65536),ye=a-y*65536,a=pe+y+65535,y=Math.floor(a/65536),pe=a-y*65536,a=fe+y+65535,y=Math.floor(a/65536),fe=a-y*65536,a=he+y+65535,y=Math.floor(a/65536),he=a-y*65536,a=ce+y+65535,y=Math.floor(a/65536),ce=a-y*65536,a=oe+y+65535,y=Math.floor(a/65536),oe=a-y*65536,a=ae+y+65535,y=Math.floor(a/65536),ae=a-y*65536,a=re+y+65535,y=Math.floor(a/65536),re=a-y*65536,K+=y-1+37*(y-1),y=1,a=K+y+65535,y=Math.floor(a/65536),K=a-y*65536,a=W+y+65535,y=Math.floor(a/65536),W=a-y*65536,a=le+y+65535,y=Math.floor(a/65536),le=a-y*65536,a=be+y+65535,y=Math.floor(a/65536),be=a-y*65536,a=de+y+65535,y=Math.floor(a/65536),de=a-y*65536,a=me+y+65535,y=Math.floor(a/65536),me=a-y*65536,a=Re+y+65535,y=Math.floor(a/65536),Re=a-y*65536,a=Ce+y+65535,y=Math.floor(a/65536),Ce=a-y*65536,a=ye+y+65535,y=Math.floor(a/65536),ye=a-y*65536,a=pe+y+65535,y=Math.floor(a/65536),pe=a-y*65536,a=fe+y+65535,y=Math.floor(a/65536),fe=a-y*65536,a=he+y+65535,y=Math.floor(a/65536),he=a-y*65536,a=ce+y+65535,y=Math.floor(a/65536),ce=a-y*65536,a=oe+y+65535,y=Math.floor(a/65536),oe=a-y*65536,a=ae+y+65535,y=Math.floor(a/65536),ae=a-y*65536,a=re+y+65535,y=Math.floor(a/65536),re=a-y*65536,K+=y-1+37*(y-1),I[0]=K,I[1]=W,I[2]=le,I[3]=be,I[4]=de,I[5]=me,I[6]=Re,I[7]=Ce,I[8]=ye,I[9]=pe,I[10]=fe,I[11]=he,I[12]=ce,I[13]=oe,I[14]=ae,I[15]=re}function l(I,x){n(I,x,x)}function R(I,x){const m=s();let a;for(a=0;a<16;a++)m[a]=x[a];for(a=253;a>=0;a--)l(m,m),a!==2&&a!==4&&n(m,m,x);for(a=0;a<16;a++)I[a]=m[a]}function F(I,x){const m=s();let a;for(a=0;a<16;a++)m[a]=x[a];for(a=250;a>=0;a--)l(m,m),a!==1&&n(m,m,x);for(a=0;a<16;a++)I[a]=m[a]}function H(I,x){const m=s(),a=s(),y=s(),K=s(),W=s(),le=s(),be=s(),de=s(),me=s();f(m,I[1],I[0]),f(me,x[1],x[0]),n(m,m,me),w(a,I[0],I[1]),w(me,x[0],x[1]),n(a,a,me),n(y,I[3],x[3]),n(y,y,g),n(K,I[2],x[2]),w(K,K,K),f(W,a,m),f(le,K,y),w(be,K,y),w(de,a,m),n(I[0],W,le),n(I[1],de,be),n(I[2],be,le),n(I[3],W,de)}function V(I,x,m){for(let a=0;a<4;a++)T(I[a],x[a],m)}function X(I,x){const m=s(),a=s(),y=s();R(y,x[2]),n(m,x[0],y),n(a,x[1],y),N(I,a),I[31]^=S(m)<<7}function E(I,x,m){D(I[0],u),D(I[1],o),D(I[2],o),D(I[3],u);for(let a=255;a>=0;--a){const y=m[a/8|0]>>(a&7)&1;V(I,x,y),H(x,I),H(I,I),V(I,x,y)}}function C(I,x){const m=[s(),s(),s(),s()];D(m[0],b),D(m[1],O),D(m[2],o),n(m[3],b,O),E(I,m,x)}function k(I){if(I.length!==r.SEED_LENGTH)throw new Error(`ed25519: seed must be ${r.SEED_LENGTH} bytes`);const x=(0,t.hash)(I);x[0]&=248,x[31]&=127,x[31]|=64;const m=new Uint8Array(32),a=[s(),s(),s(),s()];C(a,x),X(m,a);const y=new Uint8Array(64);return y.set(I),y.set(m,32),{publicKey:m,secretKey:y}}r.generateKeyPairFromSeed=k;function z(I){const x=(0,e.randomBytes)(32,I),m=k(x);return(0,i.wipe)(x),m}r.generateKeyPair=z;function L(I){if(I.length!==r.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${r.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(I.subarray(32))}r.extractPublicKeyFromSecretKey=L;const $=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function U(I,x){let m,a,y,K;for(a=63;a>=32;--a){for(m=0,y=a-32,K=a-12;y<K;++y)x[y]+=m-16*x[a]*$[y-(a-32)],m=Math.floor((x[y]+128)/256),x[y]-=m*256;x[y]+=m,x[a]=0}for(m=0,y=0;y<32;y++)x[y]+=m-(x[31]>>4)*$[y],m=x[y]>>8,x[y]&=255;for(y=0;y<32;y++)x[y]-=m*$[y];for(a=0;a<32;a++)x[a+1]+=x[a]>>8,I[a]=x[a]&255}function q(I){const x=new Float64Array(64);for(let m=0;m<64;m++)x[m]=I[m];for(let m=0;m<64;m++)I[m]=0;U(I,x)}function te(I,x){const m=new Float64Array(64),a=[s(),s(),s(),s()],y=(0,t.hash)(I.subarray(0,32));y[0]&=248,y[31]&=127,y[31]|=64;const K=new Uint8Array(64);K.set(y.subarray(32),32);const W=new t.SHA512;W.update(K.subarray(32)),W.update(x);const le=W.digest();W.clean(),q(le),C(a,le),X(K,a),W.reset(),W.update(K.subarray(0,32)),W.update(I.subarray(32)),W.update(x);const be=W.digest();q(be);for(let de=0;de<32;de++)m[de]=le[de];for(let de=0;de<32;de++)for(let me=0;me<32;me++)m[de+me]+=be[de]*y[me];return U(K.subarray(32),m),K}r.sign=te;function B(I,x){const m=s(),a=s(),y=s(),K=s(),W=s(),le=s(),be=s();return D(I[2],o),p(I[1],x),l(y,I[1]),n(K,y,h),f(y,y,I[2]),w(K,I[2],K),l(W,K),l(le,W),n(be,le,W),n(m,be,y),n(m,m,K),F(m,m),n(m,m,y),n(m,m,K),n(m,m,K),n(I[0],m,K),l(a,I[0]),n(a,a,K),_(a,y)&&n(I[0],I[0],P),l(a,I[0]),n(a,a,K),_(a,y)?-1:(S(I[0])===x[31]>>7&&f(I[0],u,I[0]),n(I[3],I[0],I[1]),0)}function Z(I,x,m){const a=new Uint8Array(32),y=[s(),s(),s(),s()],K=[s(),s(),s(),s()];if(m.length!==r.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${r.SIGNATURE_LENGTH} bytes`);if(B(K,I))return!1;const W=new t.SHA512;W.update(m.subarray(0,32)),W.update(I),W.update(x);const le=W.digest();return q(le),E(y,K,le),C(K,m.subarray(32)),H(y,K),X(a,y),!j(m,a)}r.verify=Z;function Y(I){let x=[s(),s(),s(),s()];if(B(x,I))throw new Error("Ed25519: invalid public key");let m=s(),a=s(),y=x[1];w(m,o,y),f(a,o,y),R(a,a),n(m,m,a);let K=new Uint8Array(32);return N(K,m),K}r.convertPublicKeyToX25519=Y;function Q(I){const x=(0,t.hash)(I.subarray(0,32));x[0]&=248,x[31]&=127,x[31]|=64;const m=new Uint8Array(x.subarray(0,32));return(0,i.wipe)(x),m}r.convertSecretKeyToX25519=Q})(Ui);const Bc="EdDSA",Hc="JWT",Vn=".",Gn="base64url",Kc="utf8",Vc="utf8",Gc=":",kc="did",Wc="key",Us="base58btc",Yc="z",Jc="K36",Xc=32;function Li(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function kn(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Li(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function Zc(r,e){e||(e=r.reduce((s,c)=>s+c.length,0));const t=kn(e);let i=0;for(const s of r)t.set(s,i),i+=s.length;return Li(t)}function Qc(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var c=r.charAt(s),u=c.charCodeAt(0);if(t[u]!==255)throw new TypeError(c+" is ambiguous");t[u]=s}var o=r.length,h=r.charAt(0),g=Math.log(o)/Math.log(256),b=Math.log(256)/Math.log(o);function O(A){if(A instanceof Uint8Array||(ArrayBuffer.isView(A)?A=new Uint8Array(A.buffer,A.byteOffset,A.byteLength):Array.isArray(A)&&(A=Uint8Array.from(A))),!(A instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(A.length===0)return"";for(var T=0,N=0,j=0,_=A.length;j!==_&&A[j]===0;)j++,T++;for(var S=(_-j)*b+1>>>0,p=new Uint8Array(S);j!==_;){for(var w=A[j],f=0,n=S-1;(w!==0||f<N)&&n!==-1;n--,f++)w+=256*p[n]>>>0,p[n]=w%o>>>0,w=w/o>>>0;if(w!==0)throw new Error("Non-zero carry");N=f,j++}for(var l=S-N;l!==S&&p[l]===0;)l++;for(var R=h.repeat(T);l<S;++l)R+=r.charAt(p[l]);return R}function P(A){if(typeof A!="string")throw new TypeError("Expected String");if(A.length===0)return new Uint8Array;var T=0;if(A[T]!==" "){for(var N=0,j=0;A[T]===h;)N++,T++;for(var _=(A.length-T)*g+1>>>0,S=new Uint8Array(_);A[T];){var p=t[A.charCodeAt(T)];if(p===255)return;for(var w=0,f=_-1;(p!==0||w<j)&&f!==-1;f--,w++)p+=o*S[f]>>>0,S[f]=p%256>>>0,p=p/256>>>0;if(p!==0)throw new Error("Non-zero carry");j=w,T++}if(A[T]!==" "){for(var n=_-j;n!==_&&S[n]===0;)n++;for(var l=new Uint8Array(N+(_-n)),R=N;n!==_;)l[R++]=S[n++];return l}}}function D(A){var T=P(A);if(T)return T;throw new Error(`Non-${e} character`)}return{encode:O,decodeUnsafe:P,decode:D}}var eh=Qc,th=eh;const rh=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},ih=r=>new TextEncoder().encode(r),sh=r=>new TextDecoder().decode(r);class nh{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class ah{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Wn(this,e)}}class oh{constructor(e){this.decoders=e}or(e){return Wn(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Wn=(r,e)=>new oh({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class ch{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new nh(e,t,i),this.decoder=new ah(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Wr=({name:r,prefix:e,encode:t,decode:i})=>new ch(r,e,t,i),wr=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=th(t,e);return Wr({prefix:r,name:e,encode:i,decode:c=>rh(s(c))})},hh=(r,e,t,i)=>{const s={};for(let b=0;b<e.length;++b)s[e[b]]=b;let c=r.length;for(;r[c-1]==="=";)--c;const u=new Uint8Array(c*t/8|0);let o=0,h=0,g=0;for(let b=0;b<c;++b){const O=s[r[b]];if(O===void 0)throw new SyntaxError(`Non-${i} character`);h=h<<t|O,o+=t,o>=8&&(o-=8,u[g++]=255&h>>o)}if(o>=t||255&h<<8-o)throw new SyntaxError("Unexpected end of data");return u},uh=(r,e,t)=>{const i=e[e.length-1]==="=",s=(1<<t)-1;let c="",u=0,o=0;for(let h=0;h<r.length;++h)for(o=o<<8|r[h],u+=8;u>t;)u-=t,c+=e[s&o>>u];if(u&&(c+=e[s&o<<t-u]),i)for(;c.length*t&7;)c+="=";return c},Ze=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>Wr({prefix:e,name:r,encode(s){return uh(s,i,t)},decode(s){return hh(s,i,t,r)}}),lh=Wr({prefix:"\0",name:"identity",encode:r=>sh(r),decode:r=>ih(r)}),fh=Object.freeze(Object.defineProperty({__proto__:null,identity:lh},Symbol.toStringTag,{value:"Module"})),dh=Ze({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),ph=Object.freeze(Object.defineProperty({__proto__:null,base2:dh},Symbol.toStringTag,{value:"Module"})),gh=Ze({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),yh=Object.freeze(Object.defineProperty({__proto__:null,base8:gh},Symbol.toStringTag,{value:"Module"})),bh=wr({prefix:"9",name:"base10",alphabet:"0123456789"}),wh=Object.freeze(Object.defineProperty({__proto__:null,base10:bh},Symbol.toStringTag,{value:"Module"})),_h=Ze({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),mh=Ze({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),vh=Object.freeze(Object.defineProperty({__proto__:null,base16:_h,base16upper:mh},Symbol.toStringTag,{value:"Module"})),Eh=Ze({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Dh=Ze({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Sh=Ze({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),xh=Ze({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Ih=Ze({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Oh=Ze({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Ah=Ze({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Ch=Ze({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Ph=Ze({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Th=Object.freeze(Object.defineProperty({__proto__:null,base32:Eh,base32hex:Ih,base32hexpad:Ah,base32hexpadupper:Ch,base32hexupper:Oh,base32pad:Sh,base32padupper:xh,base32upper:Dh,base32z:Ph},Symbol.toStringTag,{value:"Module"})),Nh=wr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Rh=wr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Fh=Object.freeze(Object.defineProperty({__proto__:null,base36:Nh,base36upper:Rh},Symbol.toStringTag,{value:"Module"})),Uh=wr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Lh=wr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Mh=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Uh,base58flickr:Lh},Symbol.toStringTag,{value:"Module"})),$h=Ze({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),jh=Ze({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),zh=Ze({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),qh=Ze({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Bh=Object.freeze(Object.defineProperty({__proto__:null,base64:$h,base64pad:jh,base64url:zh,base64urlpad:qh},Symbol.toStringTag,{value:"Module"})),Yn=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Hh=Yn.reduce((r,e,t)=>(r[t]=e,r),[]),Kh=Yn.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function Vh(r){return r.reduce((e,t)=>(e+=Hh[t],e),"")}function Gh(r){const e=[];for(const t of r){const i=Kh[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const kh=Wr({prefix:"🚀",name:"base256emoji",encode:Vh,decode:Gh}),Wh=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:kh},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const $r={...fh,...ph,...yh,...wh,...vh,...Th,...Fh,...Mh,...Bh,...Wh};function Jn(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const Ls=Jn("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),ui=Jn("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=kn(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),Xn={utf8:Ls,"utf-8":Ls,hex:$r.base16,latin1:ui,ascii:ui,binary:ui,...$r};function Mi(r,e="utf8"){const t=Xn[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}function $i(r,e="utf8"){const t=Xn[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Li(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}function jr(r){return Mi($i(Pi(r),Kc),Gn)}function Zn(r){const e=$i(Jc,Us),t=Yc+Mi(Zc([e,r]),Us);return[kc,Wc,t].join(Gc)}function Yh(r){return Mi(r,Gn)}function Jh(r){return $i([jr(r.header),jr(r.payload)].join(Vn),Vc)}function Xh(r){return[jr(r.header),jr(r.payload),Yh(r.signature)].join(Vn)}function Ms(r=er.randomBytes(Xc)){return Ui.generateKeyPairFromSeed(r)}async function Zh(r,e,t,i,s=ee.fromMiliseconds(Date.now())){const c={alg:Bc,typ:Hc},u=Zn(i.publicKey),o=s+t,h={iss:u,sub:r,aud:e,iat:s,exp:o},g=Jh({header:c,payload:h}),b=Ui.sign(i.secretKey,g);return Xh({header:c,payload:h,signature:b})}var ji={},Yr={};Object.defineProperty(Yr,"__esModule",{value:!0});var tt=se,vi=ct,Qh=20;function eu(r,e,t){for(var i=1634760805,s=857760878,c=2036477234,u=1797285236,o=t[3]<<24|t[2]<<16|t[1]<<8|t[0],h=t[7]<<24|t[6]<<16|t[5]<<8|t[4],g=t[11]<<24|t[10]<<16|t[9]<<8|t[8],b=t[15]<<24|t[14]<<16|t[13]<<8|t[12],O=t[19]<<24|t[18]<<16|t[17]<<8|t[16],P=t[23]<<24|t[22]<<16|t[21]<<8|t[20],D=t[27]<<24|t[26]<<16|t[25]<<8|t[24],A=t[31]<<24|t[30]<<16|t[29]<<8|t[28],T=e[3]<<24|e[2]<<16|e[1]<<8|e[0],N=e[7]<<24|e[6]<<16|e[5]<<8|e[4],j=e[11]<<24|e[10]<<16|e[9]<<8|e[8],_=e[15]<<24|e[14]<<16|e[13]<<8|e[12],S=i,p=s,w=c,f=u,n=o,l=h,R=g,F=b,H=O,V=P,X=D,E=A,C=T,k=N,z=j,L=_,$=0;$<Qh;$+=2)S=S+n|0,C^=S,C=C>>>32-16|C<<16,H=H+C|0,n^=H,n=n>>>32-12|n<<12,p=p+l|0,k^=p,k=k>>>32-16|k<<16,V=V+k|0,l^=V,l=l>>>32-12|l<<12,w=w+R|0,z^=w,z=z>>>32-16|z<<16,X=X+z|0,R^=X,R=R>>>32-12|R<<12,f=f+F|0,L^=f,L=L>>>32-16|L<<16,E=E+L|0,F^=E,F=F>>>32-12|F<<12,w=w+R|0,z^=w,z=z>>>32-8|z<<8,X=X+z|0,R^=X,R=R>>>32-7|R<<7,f=f+F|0,L^=f,L=L>>>32-8|L<<8,E=E+L|0,F^=E,F=F>>>32-7|F<<7,p=p+l|0,k^=p,k=k>>>32-8|k<<8,V=V+k|0,l^=V,l=l>>>32-7|l<<7,S=S+n|0,C^=S,C=C>>>32-8|C<<8,H=H+C|0,n^=H,n=n>>>32-7|n<<7,S=S+l|0,L^=S,L=L>>>32-16|L<<16,X=X+L|0,l^=X,l=l>>>32-12|l<<12,p=p+R|0,C^=p,C=C>>>32-16|C<<16,E=E+C|0,R^=E,R=R>>>32-12|R<<12,w=w+F|0,k^=w,k=k>>>32-16|k<<16,H=H+k|0,F^=H,F=F>>>32-12|F<<12,f=f+n|0,z^=f,z=z>>>32-16|z<<16,V=V+z|0,n^=V,n=n>>>32-12|n<<12,w=w+F|0,k^=w,k=k>>>32-8|k<<8,H=H+k|0,F^=H,F=F>>>32-7|F<<7,f=f+n|0,z^=f,z=z>>>32-8|z<<8,V=V+z|0,n^=V,n=n>>>32-7|n<<7,p=p+R|0,C^=p,C=C>>>32-8|C<<8,E=E+C|0,R^=E,R=R>>>32-7|R<<7,S=S+l|0,L^=S,L=L>>>32-8|L<<8,X=X+L|0,l^=X,l=l>>>32-7|l<<7;tt.writeUint32LE(S+i|0,r,0),tt.writeUint32LE(p+s|0,r,4),tt.writeUint32LE(w+c|0,r,8),tt.writeUint32LE(f+u|0,r,12),tt.writeUint32LE(n+o|0,r,16),tt.writeUint32LE(l+h|0,r,20),tt.writeUint32LE(R+g|0,r,24),tt.writeUint32LE(F+b|0,r,28),tt.writeUint32LE(H+O|0,r,32),tt.writeUint32LE(V+P|0,r,36),tt.writeUint32LE(X+D|0,r,40),tt.writeUint32LE(E+A|0,r,44),tt.writeUint32LE(C+T|0,r,48),tt.writeUint32LE(k+N|0,r,52),tt.writeUint32LE(z+j|0,r,56),tt.writeUint32LE(L+_|0,r,60)}function Qn(r,e,t,i,s){if(s===void 0&&(s=0),r.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(i.length<t.length)throw new Error("ChaCha: destination is shorter than source");var c,u;if(s===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");c=new Uint8Array(16),u=c.length-e.length,c.set(e,u)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");c=e,u=s}for(var o=new Uint8Array(64),h=0;h<t.length;h+=64){eu(o,c,r);for(var g=h;g<h+64&&g<t.length;g++)i[g]=t[g]^o[g-h];ru(c,0,u)}return vi.wipe(o),s===0&&vi.wipe(c),i}Yr.streamXOR=Qn;function tu(r,e,t,i){return i===void 0&&(i=0),vi.wipe(t),Qn(r,e,t,t,i)}Yr.stream=tu;function ru(r,e,t){for(var i=1;t--;)i=i+(r[e]&255)|0,r[e]=i&255,i>>>=8,e++;if(i>0)throw new Error("ChaCha: counter overflow")}var ea={},Mt={};Object.defineProperty(Mt,"__esModule",{value:!0});function iu(r,e,t){return~(r-1)&e|r-1&t}Mt.select=iu;function su(r,e){return(r|0)-(e|0)-1>>>31&1}Mt.lessOrEqual=su;function ta(r,e){if(r.length!==e.length)return 0;for(var t=0,i=0;i<r.length;i++)t|=r[i]^e[i];return 1&t-1>>>8}Mt.compare=ta;function nu(r,e){return r.length===0||e.length===0?!1:ta(r,e)!==0}Mt.equal=nu;(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=Mt,t=ct;r.DIGEST_LENGTH=16;var i=function(){function u(o){this.digestLength=r.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var h=o[0]|o[1]<<8;this._r[0]=h&8191;var g=o[2]|o[3]<<8;this._r[1]=(h>>>13|g<<3)&8191;var b=o[4]|o[5]<<8;this._r[2]=(g>>>10|b<<6)&7939;var O=o[6]|o[7]<<8;this._r[3]=(b>>>7|O<<9)&8191;var P=o[8]|o[9]<<8;this._r[4]=(O>>>4|P<<12)&255,this._r[5]=P>>>1&8190;var D=o[10]|o[11]<<8;this._r[6]=(P>>>14|D<<2)&8191;var A=o[12]|o[13]<<8;this._r[7]=(D>>>11|A<<5)&8065;var T=o[14]|o[15]<<8;this._r[8]=(A>>>8|T<<8)&8191,this._r[9]=T>>>5&127,this._pad[0]=o[16]|o[17]<<8,this._pad[1]=o[18]|o[19]<<8,this._pad[2]=o[20]|o[21]<<8,this._pad[3]=o[22]|o[23]<<8,this._pad[4]=o[24]|o[25]<<8,this._pad[5]=o[26]|o[27]<<8,this._pad[6]=o[28]|o[29]<<8,this._pad[7]=o[30]|o[31]<<8}return u.prototype._blocks=function(o,h,g){for(var b=this._fin?0:2048,O=this._h[0],P=this._h[1],D=this._h[2],A=this._h[3],T=this._h[4],N=this._h[5],j=this._h[6],_=this._h[7],S=this._h[8],p=this._h[9],w=this._r[0],f=this._r[1],n=this._r[2],l=this._r[3],R=this._r[4],F=this._r[5],H=this._r[6],V=this._r[7],X=this._r[8],E=this._r[9];g>=16;){var C=o[h+0]|o[h+1]<<8;O+=C&8191;var k=o[h+2]|o[h+3]<<8;P+=(C>>>13|k<<3)&8191;var z=o[h+4]|o[h+5]<<8;D+=(k>>>10|z<<6)&8191;var L=o[h+6]|o[h+7]<<8;A+=(z>>>7|L<<9)&8191;var $=o[h+8]|o[h+9]<<8;T+=(L>>>4|$<<12)&8191,N+=$>>>1&8191;var U=o[h+10]|o[h+11]<<8;j+=($>>>14|U<<2)&8191;var q=o[h+12]|o[h+13]<<8;_+=(U>>>11|q<<5)&8191;var te=o[h+14]|o[h+15]<<8;S+=(q>>>8|te<<8)&8191,p+=te>>>5|b;var B=0,Z=B;Z+=O*w,Z+=P*(5*E),Z+=D*(5*X),Z+=A*(5*V),Z+=T*(5*H),B=Z>>>13,Z&=8191,Z+=N*(5*F),Z+=j*(5*R),Z+=_*(5*l),Z+=S*(5*n),Z+=p*(5*f),B+=Z>>>13,Z&=8191;var Y=B;Y+=O*f,Y+=P*w,Y+=D*(5*E),Y+=A*(5*X),Y+=T*(5*V),B=Y>>>13,Y&=8191,Y+=N*(5*H),Y+=j*(5*F),Y+=_*(5*R),Y+=S*(5*l),Y+=p*(5*n),B+=Y>>>13,Y&=8191;var Q=B;Q+=O*n,Q+=P*f,Q+=D*w,Q+=A*(5*E),Q+=T*(5*X),B=Q>>>13,Q&=8191,Q+=N*(5*V),Q+=j*(5*H),Q+=_*(5*F),Q+=S*(5*R),Q+=p*(5*l),B+=Q>>>13,Q&=8191;var I=B;I+=O*l,I+=P*n,I+=D*f,I+=A*w,I+=T*(5*E),B=I>>>13,I&=8191,I+=N*(5*X),I+=j*(5*V),I+=_*(5*H),I+=S*(5*F),I+=p*(5*R),B+=I>>>13,I&=8191;var x=B;x+=O*R,x+=P*l,x+=D*n,x+=A*f,x+=T*w,B=x>>>13,x&=8191,x+=N*(5*E),x+=j*(5*X),x+=_*(5*V),x+=S*(5*H),x+=p*(5*F),B+=x>>>13,x&=8191;var m=B;m+=O*F,m+=P*R,m+=D*l,m+=A*n,m+=T*f,B=m>>>13,m&=8191,m+=N*w,m+=j*(5*E),m+=_*(5*X),m+=S*(5*V),m+=p*(5*H),B+=m>>>13,m&=8191;var a=B;a+=O*H,a+=P*F,a+=D*R,a+=A*l,a+=T*n,B=a>>>13,a&=8191,a+=N*f,a+=j*w,a+=_*(5*E),a+=S*(5*X),a+=p*(5*V),B+=a>>>13,a&=8191;var y=B;y+=O*V,y+=P*H,y+=D*F,y+=A*R,y+=T*l,B=y>>>13,y&=8191,y+=N*n,y+=j*f,y+=_*w,y+=S*(5*E),y+=p*(5*X),B+=y>>>13,y&=8191;var K=B;K+=O*X,K+=P*V,K+=D*H,K+=A*F,K+=T*R,B=K>>>13,K&=8191,K+=N*l,K+=j*n,K+=_*f,K+=S*w,K+=p*(5*E),B+=K>>>13,K&=8191;var W=B;W+=O*E,W+=P*X,W+=D*V,W+=A*H,W+=T*F,B=W>>>13,W&=8191,W+=N*R,W+=j*l,W+=_*n,W+=S*f,W+=p*w,B+=W>>>13,W&=8191,B=(B<<2)+B|0,B=B+Z|0,Z=B&8191,B=B>>>13,Y+=B,O=Z,P=Y,D=Q,A=I,T=x,N=m,j=a,_=y,S=K,p=W,h+=16,g-=16}this._h[0]=O,this._h[1]=P,this._h[2]=D,this._h[3]=A,this._h[4]=T,this._h[5]=N,this._h[6]=j,this._h[7]=_,this._h[8]=S,this._h[9]=p},u.prototype.finish=function(o,h){h===void 0&&(h=0);var g=new Uint16Array(10),b,O,P,D;if(this._leftover){for(D=this._leftover,this._buffer[D++]=1;D<16;D++)this._buffer[D]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(b=this._h[1]>>>13,this._h[1]&=8191,D=2;D<10;D++)this._h[D]+=b,b=this._h[D]>>>13,this._h[D]&=8191;for(this._h[0]+=b*5,b=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=b,b=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=b,g[0]=this._h[0]+5,b=g[0]>>>13,g[0]&=8191,D=1;D<10;D++)g[D]=this._h[D]+b,b=g[D]>>>13,g[D]&=8191;for(g[9]-=1<<13,O=(b^1)-1,D=0;D<10;D++)g[D]&=O;for(O=~O,D=0;D<10;D++)this._h[D]=this._h[D]&O|g[D];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,P=this._h[0]+this._pad[0],this._h[0]=P&65535,D=1;D<8;D++)P=(this._h[D]+this._pad[D]|0)+(P>>>16)|0,this._h[D]=P&65535;return o[h+0]=this._h[0]>>>0,o[h+1]=this._h[0]>>>8,o[h+2]=this._h[1]>>>0,o[h+3]=this._h[1]>>>8,o[h+4]=this._h[2]>>>0,o[h+5]=this._h[2]>>>8,o[h+6]=this._h[3]>>>0,o[h+7]=this._h[3]>>>8,o[h+8]=this._h[4]>>>0,o[h+9]=this._h[4]>>>8,o[h+10]=this._h[5]>>>0,o[h+11]=this._h[5]>>>8,o[h+12]=this._h[6]>>>0,o[h+13]=this._h[6]>>>8,o[h+14]=this._h[7]>>>0,o[h+15]=this._h[7]>>>8,this._finished=!0,this},u.prototype.update=function(o){var h=0,g=o.length,b;if(this._leftover){b=16-this._leftover,b>g&&(b=g);for(var O=0;O<b;O++)this._buffer[this._leftover+O]=o[h+O];if(g-=b,h+=b,this._leftover+=b,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(g>=16&&(b=g-g%16,this._blocks(o,h,b),h+=b,g-=b),g){for(var O=0;O<g;O++)this._buffer[this._leftover+O]=o[h+O];this._leftover+=g}return this},u.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var o=new Uint8Array(16);return this.finish(o),o},u.prototype.clean=function(){return t.wipe(this._buffer),t.wipe(this._r),t.wipe(this._h),t.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},u}();r.Poly1305=i;function s(u,o){var h=new i(u);h.update(o);var g=h.digest();return h.clean(),g}r.oneTimeAuth=s;function c(u,o){return u.length!==r.DIGEST_LENGTH||o.length!==r.DIGEST_LENGTH?!1:e.equal(u,o)}r.equal=c})(ea);(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=Yr,t=ea,i=ct,s=se,c=Mt;r.KEY_LENGTH=32,r.NONCE_LENGTH=12,r.TAG_LENGTH=16;var u=new Uint8Array(16),o=function(){function h(g){if(this.nonceLength=r.NONCE_LENGTH,this.tagLength=r.TAG_LENGTH,g.length!==r.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(g)}return h.prototype.seal=function(g,b,O,P){if(g.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var D=new Uint8Array(16);D.set(g,D.length-g.length);var A=new Uint8Array(32);e.stream(this._key,D,A,4);var T=b.length+this.tagLength,N;if(P){if(P.length!==T)throw new Error("ChaCha20Poly1305: incorrect destination length");N=P}else N=new Uint8Array(T);return e.streamXOR(this._key,D,b,N,4),this._authenticate(N.subarray(N.length-this.tagLength,N.length),A,N.subarray(0,N.length-this.tagLength),O),i.wipe(D),N},h.prototype.open=function(g,b,O,P){if(g.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(b.length<this.tagLength)return null;var D=new Uint8Array(16);D.set(g,D.length-g.length);var A=new Uint8Array(32);e.stream(this._key,D,A,4);var T=new Uint8Array(this.tagLength);if(this._authenticate(T,A,b.subarray(0,b.length-this.tagLength),O),!c.equal(T,b.subarray(b.length-this.tagLength,b.length)))return null;var N=b.length-this.tagLength,j;if(P){if(P.length!==N)throw new Error("ChaCha20Poly1305: incorrect destination length");j=P}else j=new Uint8Array(N);return e.streamXOR(this._key,D,b.subarray(0,b.length-this.tagLength),j,4),i.wipe(D),j},h.prototype.clean=function(){return i.wipe(this._key),this},h.prototype._authenticate=function(g,b,O,P){var D=new t.Poly1305(b);P&&(D.update(P),P.length%16>0&&D.update(u.subarray(P.length%16))),D.update(O),O.length%16>0&&D.update(u.subarray(O.length%16));var A=new Uint8Array(8);P&&s.writeUint64LE(P.length,A),D.update(A),s.writeUint64LE(O.length,A),D.update(A);for(var T=D.digest(),N=0;N<T.length;N++)g[N]=T[N];D.clean(),i.wipe(T),i.wipe(A)},h}();r.ChaCha20Poly1305=o})(ji);var ra={},_r={},zi={};Object.defineProperty(zi,"__esModule",{value:!0});function au(r){return typeof r.saveState<"u"&&typeof r.restoreState<"u"&&typeof r.cleanSavedState<"u"}zi.isSerializableHash=au;Object.defineProperty(_r,"__esModule",{value:!0});var mt=zi,ou=Mt,cu=ct,ia=function(){function r(e,t){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var i=new Uint8Array(this.blockSize);t.length>this.blockSize?this._inner.update(t).finish(i).clean():i.set(t);for(var s=0;s<i.length;s++)i[s]^=54;this._inner.update(i);for(var s=0;s<i.length;s++)i[s]^=106;this._outer.update(i),mt.isSerializableHash(this._inner)&&mt.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),cu.wipe(i)}return r.prototype.reset=function(){if(!mt.isSerializableHash(this._inner)||!mt.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},r.prototype.clean=function(){mt.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),mt.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},r.prototype.update=function(e){return this._inner.update(e),this},r.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},r.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},r.prototype.saveState=function(){if(!mt.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},r.prototype.restoreState=function(e){if(!mt.isSerializableHash(this._inner)||!mt.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},r.prototype.cleanSavedState=function(e){if(!mt.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},r}();_r.HMAC=ia;function hu(r,e,t){var i=new ia(r,e);i.update(t);var s=i.digest();return i.clean(),s}_r.hmac=hu;_r.equal=ou.equal;Object.defineProperty(ra,"__esModule",{value:!0});var $s=_r,js=ct,uu=function(){function r(e,t,i,s){i===void 0&&(i=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=s;var c=$s.hmac(this._hash,i,t);this._hmac=new $s.HMAC(e,c),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return r.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},r.prototype.expand=function(e){for(var t=new Uint8Array(e),i=0;i<t.length;i++)this._bufpos===this._buffer.length&&this._fillBuffer(),t[i]=this._buffer[this._bufpos++];return t},r.prototype.clean=function(){this._hmac.clean(),js.wipe(this._buffer),js.wipe(this._counter),this._bufpos=0},r}(),lu=ra.HKDF=uu,Jr={};(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=se,t=ct;r.DIGEST_LENGTH=32,r.BLOCK_SIZE=64;var i=function(){function o(){this.digestLength=r.DIGEST_LENGTH,this.blockSize=r.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return o.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},o.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},o.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._temp),this.reset()},o.prototype.update=function(h,g){if(g===void 0&&(g=h.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var b=0;if(this._bytesHashed+=g,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&g>0;)this._buffer[this._bufferLength++]=h[b++],g--;this._bufferLength===this.blockSize&&(c(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(g>=this.blockSize&&(b=c(this._temp,this._state,h,b,g),g%=this.blockSize);g>0;)this._buffer[this._bufferLength++]=h[b++],g--;return this},o.prototype.finish=function(h){if(!this._finished){var g=this._bytesHashed,b=this._bufferLength,O=g/536870912|0,P=g<<3,D=g%64<56?64:128;this._buffer[b]=128;for(var A=b+1;A<D-8;A++)this._buffer[A]=0;e.writeUint32BE(O,this._buffer,D-8),e.writeUint32BE(P,this._buffer,D-4),c(this._temp,this._state,this._buffer,0,D),this._finished=!0}for(var A=0;A<this.digestLength/4;A++)e.writeUint32BE(this._state[A],h,A*4);return this},o.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},o.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},o.prototype.restoreState=function(h){return this._state.set(h.state),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},o.prototype.cleanSavedState=function(h){t.wipe(h.state),h.buffer&&t.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},o}();r.SHA256=i;var s=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function c(o,h,g,b,O){for(;O>=64;){for(var P=h[0],D=h[1],A=h[2],T=h[3],N=h[4],j=h[5],_=h[6],S=h[7],p=0;p<16;p++){var w=b+p*4;o[p]=e.readUint32BE(g,w)}for(var p=16;p<64;p++){var f=o[p-2],n=(f>>>17|f<<32-17)^(f>>>19|f<<32-19)^f>>>10;f=o[p-15];var l=(f>>>7|f<<32-7)^(f>>>18|f<<32-18)^f>>>3;o[p]=(n+o[p-7]|0)+(l+o[p-16]|0)}for(var p=0;p<64;p++){var n=(((N>>>6|N<<26)^(N>>>11|N<<21)^(N>>>25|N<<7))+(N&j^~N&_)|0)+(S+(s[p]+o[p]|0)|0)|0,l=((P>>>2|P<<32-2)^(P>>>13|P<<32-13)^(P>>>22|P<<32-22))+(P&D^P&A^D&A)|0;S=_,_=j,j=N,N=T+n|0,T=A,A=D,D=P,P=n+l|0}h[0]+=P,h[1]+=D,h[2]+=A,h[3]+=T,h[4]+=N,h[5]+=j,h[6]+=_,h[7]+=S,b+=64,O-=64}return b}function u(o){var h=new i;h.update(o);var g=h.digest();return h.clean(),g}r.hash=u})(Jr);var qi={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.sharedKey=r.generateKeyPair=r.generateKeyPairFromSeed=r.scalarMultBase=r.scalarMult=r.SHARED_KEY_LENGTH=r.SECRET_KEY_LENGTH=r.PUBLIC_KEY_LENGTH=void 0;const e=er,t=ct;r.PUBLIC_KEY_LENGTH=32,r.SECRET_KEY_LENGTH=32,r.SHARED_KEY_LENGTH=32;function i(p){const w=new Float64Array(16);if(p)for(let f=0;f<p.length;f++)w[f]=p[f];return w}const s=new Uint8Array(32);s[0]=9;const c=i([56129,1]);function u(p){let w=1;for(let f=0;f<16;f++){let n=p[f]+w+65535;w=Math.floor(n/65536),p[f]=n-w*65536}p[0]+=w-1+37*(w-1)}function o(p,w,f){const n=~(f-1);for(let l=0;l<16;l++){const R=n&(p[l]^w[l]);p[l]^=R,w[l]^=R}}function h(p,w){const f=i(),n=i();for(let l=0;l<16;l++)n[l]=w[l];u(n),u(n),u(n);for(let l=0;l<2;l++){f[0]=n[0]-65517;for(let F=1;F<15;F++)f[F]=n[F]-65535-(f[F-1]>>16&1),f[F-1]&=65535;f[15]=n[15]-32767-(f[14]>>16&1);const R=f[15]>>16&1;f[14]&=65535,o(n,f,1-R)}for(let l=0;l<16;l++)p[2*l]=n[l]&255,p[2*l+1]=n[l]>>8}function g(p,w){for(let f=0;f<16;f++)p[f]=w[2*f]+(w[2*f+1]<<8);p[15]&=32767}function b(p,w,f){for(let n=0;n<16;n++)p[n]=w[n]+f[n]}function O(p,w,f){for(let n=0;n<16;n++)p[n]=w[n]-f[n]}function P(p,w,f){let n,l,R=0,F=0,H=0,V=0,X=0,E=0,C=0,k=0,z=0,L=0,$=0,U=0,q=0,te=0,B=0,Z=0,Y=0,Q=0,I=0,x=0,m=0,a=0,y=0,K=0,W=0,le=0,be=0,de=0,me=0,Re=0,Ce=0,ye=f[0],pe=f[1],fe=f[2],he=f[3],ce=f[4],oe=f[5],ae=f[6],re=f[7],ue=f[8],ge=f[9],ie=f[10],we=f[11],_e=f[12],Ee=f[13],De=f[14],ve=f[15];n=w[0],R+=n*ye,F+=n*pe,H+=n*fe,V+=n*he,X+=n*ce,E+=n*oe,C+=n*ae,k+=n*re,z+=n*ue,L+=n*ge,$+=n*ie,U+=n*we,q+=n*_e,te+=n*Ee,B+=n*De,Z+=n*ve,n=w[1],F+=n*ye,H+=n*pe,V+=n*fe,X+=n*he,E+=n*ce,C+=n*oe,k+=n*ae,z+=n*re,L+=n*ue,$+=n*ge,U+=n*ie,q+=n*we,te+=n*_e,B+=n*Ee,Z+=n*De,Y+=n*ve,n=w[2],H+=n*ye,V+=n*pe,X+=n*fe,E+=n*he,C+=n*ce,k+=n*oe,z+=n*ae,L+=n*re,$+=n*ue,U+=n*ge,q+=n*ie,te+=n*we,B+=n*_e,Z+=n*Ee,Y+=n*De,Q+=n*ve,n=w[3],V+=n*ye,X+=n*pe,E+=n*fe,C+=n*he,k+=n*ce,z+=n*oe,L+=n*ae,$+=n*re,U+=n*ue,q+=n*ge,te+=n*ie,B+=n*we,Z+=n*_e,Y+=n*Ee,Q+=n*De,I+=n*ve,n=w[4],X+=n*ye,E+=n*pe,C+=n*fe,k+=n*he,z+=n*ce,L+=n*oe,$+=n*ae,U+=n*re,q+=n*ue,te+=n*ge,B+=n*ie,Z+=n*we,Y+=n*_e,Q+=n*Ee,I+=n*De,x+=n*ve,n=w[5],E+=n*ye,C+=n*pe,k+=n*fe,z+=n*he,L+=n*ce,$+=n*oe,U+=n*ae,q+=n*re,te+=n*ue,B+=n*ge,Z+=n*ie,Y+=n*we,Q+=n*_e,I+=n*Ee,x+=n*De,m+=n*ve,n=w[6],C+=n*ye,k+=n*pe,z+=n*fe,L+=n*he,$+=n*ce,U+=n*oe,q+=n*ae,te+=n*re,B+=n*ue,Z+=n*ge,Y+=n*ie,Q+=n*we,I+=n*_e,x+=n*Ee,m+=n*De,a+=n*ve,n=w[7],k+=n*ye,z+=n*pe,L+=n*fe,$+=n*he,U+=n*ce,q+=n*oe,te+=n*ae,B+=n*re,Z+=n*ue,Y+=n*ge,Q+=n*ie,I+=n*we,x+=n*_e,m+=n*Ee,a+=n*De,y+=n*ve,n=w[8],z+=n*ye,L+=n*pe,$+=n*fe,U+=n*he,q+=n*ce,te+=n*oe,B+=n*ae,Z+=n*re,Y+=n*ue,Q+=n*ge,I+=n*ie,x+=n*we,m+=n*_e,a+=n*Ee,y+=n*De,K+=n*ve,n=w[9],L+=n*ye,$+=n*pe,U+=n*fe,q+=n*he,te+=n*ce,B+=n*oe,Z+=n*ae,Y+=n*re,Q+=n*ue,I+=n*ge,x+=n*ie,m+=n*we,a+=n*_e,y+=n*Ee,K+=n*De,W+=n*ve,n=w[10],$+=n*ye,U+=n*pe,q+=n*fe,te+=n*he,B+=n*ce,Z+=n*oe,Y+=n*ae,Q+=n*re,I+=n*ue,x+=n*ge,m+=n*ie,a+=n*we,y+=n*_e,K+=n*Ee,W+=n*De,le+=n*ve,n=w[11],U+=n*ye,q+=n*pe,te+=n*fe,B+=n*he,Z+=n*ce,Y+=n*oe,Q+=n*ae,I+=n*re,x+=n*ue,m+=n*ge,a+=n*ie,y+=n*we,K+=n*_e,W+=n*Ee,le+=n*De,be+=n*ve,n=w[12],q+=n*ye,te+=n*pe,B+=n*fe,Z+=n*he,Y+=n*ce,Q+=n*oe,I+=n*ae,x+=n*re,m+=n*ue,a+=n*ge,y+=n*ie,K+=n*we,W+=n*_e,le+=n*Ee,be+=n*De,de+=n*ve,n=w[13],te+=n*ye,B+=n*pe,Z+=n*fe,Y+=n*he,Q+=n*ce,I+=n*oe,x+=n*ae,m+=n*re,a+=n*ue,y+=n*ge,K+=n*ie,W+=n*we,le+=n*_e,be+=n*Ee,de+=n*De,me+=n*ve,n=w[14],B+=n*ye,Z+=n*pe,Y+=n*fe,Q+=n*he,I+=n*ce,x+=n*oe,m+=n*ae,a+=n*re,y+=n*ue,K+=n*ge,W+=n*ie,le+=n*we,be+=n*_e,de+=n*Ee,me+=n*De,Re+=n*ve,n=w[15],Z+=n*ye,Y+=n*pe,Q+=n*fe,I+=n*he,x+=n*ce,m+=n*oe,a+=n*ae,y+=n*re,K+=n*ue,W+=n*ge,le+=n*ie,be+=n*we,de+=n*_e,me+=n*Ee,Re+=n*De,Ce+=n*ve,R+=38*Y,F+=38*Q,H+=38*I,V+=38*x,X+=38*m,E+=38*a,C+=38*y,k+=38*K,z+=38*W,L+=38*le,$+=38*be,U+=38*de,q+=38*me,te+=38*Re,B+=38*Ce,l=1,n=R+l+65535,l=Math.floor(n/65536),R=n-l*65536,n=F+l+65535,l=Math.floor(n/65536),F=n-l*65536,n=H+l+65535,l=Math.floor(n/65536),H=n-l*65536,n=V+l+65535,l=Math.floor(n/65536),V=n-l*65536,n=X+l+65535,l=Math.floor(n/65536),X=n-l*65536,n=E+l+65535,l=Math.floor(n/65536),E=n-l*65536,n=C+l+65535,l=Math.floor(n/65536),C=n-l*65536,n=k+l+65535,l=Math.floor(n/65536),k=n-l*65536,n=z+l+65535,l=Math.floor(n/65536),z=n-l*65536,n=L+l+65535,l=Math.floor(n/65536),L=n-l*65536,n=$+l+65535,l=Math.floor(n/65536),$=n-l*65536,n=U+l+65535,l=Math.floor(n/65536),U=n-l*65536,n=q+l+65535,l=Math.floor(n/65536),q=n-l*65536,n=te+l+65535,l=Math.floor(n/65536),te=n-l*65536,n=B+l+65535,l=Math.floor(n/65536),B=n-l*65536,n=Z+l+65535,l=Math.floor(n/65536),Z=n-l*65536,R+=l-1+37*(l-1),l=1,n=R+l+65535,l=Math.floor(n/65536),R=n-l*65536,n=F+l+65535,l=Math.floor(n/65536),F=n-l*65536,n=H+l+65535,l=Math.floor(n/65536),H=n-l*65536,n=V+l+65535,l=Math.floor(n/65536),V=n-l*65536,n=X+l+65535,l=Math.floor(n/65536),X=n-l*65536,n=E+l+65535,l=Math.floor(n/65536),E=n-l*65536,n=C+l+65535,l=Math.floor(n/65536),C=n-l*65536,n=k+l+65535,l=Math.floor(n/65536),k=n-l*65536,n=z+l+65535,l=Math.floor(n/65536),z=n-l*65536,n=L+l+65535,l=Math.floor(n/65536),L=n-l*65536,n=$+l+65535,l=Math.floor(n/65536),$=n-l*65536,n=U+l+65535,l=Math.floor(n/65536),U=n-l*65536,n=q+l+65535,l=Math.floor(n/65536),q=n-l*65536,n=te+l+65535,l=Math.floor(n/65536),te=n-l*65536,n=B+l+65535,l=Math.floor(n/65536),B=n-l*65536,n=Z+l+65535,l=Math.floor(n/65536),Z=n-l*65536,R+=l-1+37*(l-1),p[0]=R,p[1]=F,p[2]=H,p[3]=V,p[4]=X,p[5]=E,p[6]=C,p[7]=k,p[8]=z,p[9]=L,p[10]=$,p[11]=U,p[12]=q,p[13]=te,p[14]=B,p[15]=Z}function D(p,w){P(p,w,w)}function A(p,w){const f=i();for(let n=0;n<16;n++)f[n]=w[n];for(let n=253;n>=0;n--)D(f,f),n!==2&&n!==4&&P(f,f,w);for(let n=0;n<16;n++)p[n]=f[n]}function T(p,w){const f=new Uint8Array(32),n=new Float64Array(80),l=i(),R=i(),F=i(),H=i(),V=i(),X=i();for(let z=0;z<31;z++)f[z]=p[z];f[31]=p[31]&127|64,f[0]&=248,g(n,w);for(let z=0;z<16;z++)R[z]=n[z];l[0]=H[0]=1;for(let z=254;z>=0;--z){const L=f[z>>>3]>>>(z&7)&1;o(l,R,L),o(F,H,L),b(V,l,F),O(l,l,F),b(F,R,H),O(R,R,H),D(H,V),D(X,l),P(l,F,l),P(F,R,V),b(V,l,F),O(l,l,F),D(R,l),O(F,H,X),P(l,F,c),b(l,l,H),P(F,F,l),P(l,H,X),P(H,R,n),D(R,V),o(l,R,L),o(F,H,L)}for(let z=0;z<16;z++)n[z+16]=l[z],n[z+32]=F[z],n[z+48]=R[z],n[z+64]=H[z];const E=n.subarray(32),C=n.subarray(16);A(E,E),P(C,C,E);const k=new Uint8Array(32);return h(k,C),k}r.scalarMult=T;function N(p){return T(p,s)}r.scalarMultBase=N;function j(p){if(p.length!==r.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${r.SECRET_KEY_LENGTH} bytes`);const w=new Uint8Array(p);return{publicKey:N(w),secretKey:w}}r.generateKeyPairFromSeed=j;function _(p){const w=(0,e.randomBytes)(32,p),f=j(w);return(0,t.wipe)(w),f}r.generateKeyPair=_;function S(p,w,f=!1){if(p.length!==r.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(w.length!==r.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const n=T(p,w);if(f){let l=0;for(let R=0;R<n.length;R++)l|=n[R];if(l===0)throw new Error("X25519: invalid shared key")}return n}r.sharedKey=S})(qi);function sa(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}function zs(r,e){e||(e=r.reduce((s,c)=>s+c.length,0));const t=sa(e);let i=0;for(const s of r)t.set(s,i),i+=s.length;return t}function na(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const qs=na("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),li=na("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=sa(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),aa={utf8:qs,"utf-8":qs,hex:$r.base16,latin1:li,ascii:li,binary:li,...$r};function yt(r,e="utf8"){const t=aa[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r,"utf8"):t.decoder.decode(`${t.prefix}${r}`)}function bt(r,e="utf8"){const t=aa[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}var Bs=globalThis&&globalThis.__spreadArray||function(r,e,t){if(t||arguments.length===2)for(var i=0,s=e.length,c;i<s;i++)(c||!(i in e))&&(c||(c=Array.prototype.slice.call(e,0,i)),c[i]=e[i]);return r.concat(c||Array.prototype.slice.call(e))},fu=function(){function r(e,t,i){this.name=e,this.version=t,this.os=i,this.type="browser"}return r}(),du=function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return r}(),pu=function(){function r(e,t,i,s){this.name=e,this.version=t,this.os=i,this.bot=s,this.type="bot-device"}return r}(),gu=function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r}(),yu=function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r}(),bu=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,wu=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Hs=3,_u=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",bu]],Ks=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function mu(r){return r?Vs(r):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new yu:typeof navigator<"u"?Vs(navigator.userAgent):Du()}function vu(r){return r!==""&&_u.reduce(function(e,t){var i=t[0],s=t[1];if(e)return e;var c=s.exec(r);return!!c&&[i,c]},!1)}function Vs(r){var e=vu(r);if(!e)return null;var t=e[0],i=e[1];if(t==="searchbot")return new gu;var s=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);s?s.length<Hs&&(s=Bs(Bs([],s,!0),Su(Hs-s.length),!0)):s=[];var c=s.join("."),u=Eu(r),o=wu.exec(r);return o&&o[1]?new pu(t,c,u,o[1]):new fu(t,c,u)}function Eu(r){for(var e=0,t=Ks.length;e<t;e++){var i=Ks[e],s=i[0],c=i[1],u=c.exec(r);if(u)return s}return null}function Du(){var r=typeof process<"u"&&process.version;return r?new du(process.version.slice(1)):null}function Su(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}var xe={};Object.defineProperty(xe,"__esModule",{value:!0});xe.getLocalStorage=xe.getLocalStorageOrThrow=xe.getCrypto=xe.getCryptoOrThrow=ca=xe.getLocation=xe.getLocationOrThrow=Bi=xe.getNavigator=xe.getNavigatorOrThrow=oa=xe.getDocument=xe.getDocumentOrThrow=xe.getFromWindowOrThrow=xe.getFromWindow=void 0;function Yt(r){let e;return typeof window<"u"&&typeof window[r]<"u"&&(e=window[r]),e}xe.getFromWindow=Yt;function tr(r){const e=Yt(r);if(!e)throw new Error(`${r} is not defined in Window`);return e}xe.getFromWindowOrThrow=tr;function xu(){return tr("document")}xe.getDocumentOrThrow=xu;function Iu(){return Yt("document")}var oa=xe.getDocument=Iu;function Ou(){return tr("navigator")}xe.getNavigatorOrThrow=Ou;function Au(){return Yt("navigator")}var Bi=xe.getNavigator=Au;function Cu(){return tr("location")}xe.getLocationOrThrow=Cu;function Pu(){return Yt("location")}var ca=xe.getLocation=Pu;function Tu(){return tr("crypto")}xe.getCryptoOrThrow=Tu;function Nu(){return Yt("crypto")}xe.getCrypto=Nu;function Ru(){return tr("localStorage")}xe.getLocalStorageOrThrow=Ru;function Fu(){return Yt("localStorage")}xe.getLocalStorage=Fu;var Hi={};Object.defineProperty(Hi,"__esModule",{value:!0});var ha=Hi.getWindowMetadata=void 0;const Gs=xe;function Uu(){let r,e;try{r=Gs.getDocumentOrThrow(),e=Gs.getLocationOrThrow()}catch{return null}function t(){const O=r.getElementsByTagName("link"),P=[];for(let D=0;D<O.length;D++){const A=O[D],T=A.getAttribute("rel");if(T&&T.toLowerCase().indexOf("icon")>-1){const N=A.getAttribute("href");if(N)if(N.toLowerCase().indexOf("https:")===-1&&N.toLowerCase().indexOf("http:")===-1&&N.indexOf("//")!==0){let j=e.protocol+"//"+e.host;if(N.indexOf("/")===0)j+=N;else{const _=e.pathname.split("/");_.pop();const S=_.join("/");j+=S+"/"+N}P.push(j)}else if(N.indexOf("//")===0){const j=e.protocol+N;P.push(j)}else P.push(N)}}return P}function i(...O){const P=r.getElementsByTagName("meta");for(let D=0;D<P.length;D++){const A=P[D],T=["itemprop","property","name"].map(N=>A.getAttribute(N)).filter(N=>N?O.includes(N):!1);if(T.length&&T){const N=A.getAttribute("content");if(N)return N}}return""}function s(){let O=i("name","og:site_name","og:title","twitter:title");return O||(O=r.title),O}function c(){return i("description","og:description","twitter:description","keywords")}const u=s(),o=c(),h=e.origin,g=t();return{description:o,url:h,icons:g,name:u}}ha=Hi.getWindowMetadata=Uu;var pr={},Lu=function(r,e){for(var t={},i=Object.keys(r),s=Array.isArray(e),c=0;c<i.length;c++){var u=i[c],o=r[u];(s?e.indexOf(u)!==-1:e(u,o,r))&&(t[u]=o)}return t};(function(r){const e=Ao,t=Co,i=Oo,s=Lu,c=_=>_==null,u=Symbol("encodeFragmentIdentifier");function o(_){switch(_.arrayFormat){case"index":return S=>(p,w)=>{const f=p.length;return w===void 0||_.skipNull&&w===null||_.skipEmptyString&&w===""?p:w===null?[...p,[b(S,_),"[",f,"]"].join("")]:[...p,[b(S,_),"[",b(f,_),"]=",b(w,_)].join("")]};case"bracket":return S=>(p,w)=>w===void 0||_.skipNull&&w===null||_.skipEmptyString&&w===""?p:w===null?[...p,[b(S,_),"[]"].join("")]:[...p,[b(S,_),"[]=",b(w,_)].join("")];case"colon-list-separator":return S=>(p,w)=>w===void 0||_.skipNull&&w===null||_.skipEmptyString&&w===""?p:w===null?[...p,[b(S,_),":list="].join("")]:[...p,[b(S,_),":list=",b(w,_)].join("")];case"comma":case"separator":case"bracket-separator":{const S=_.arrayFormat==="bracket-separator"?"[]=":"=";return p=>(w,f)=>f===void 0||_.skipNull&&f===null||_.skipEmptyString&&f===""?w:(f=f===null?"":f,w.length===0?[[b(p,_),S,b(f,_)].join("")]:[[w,b(f,_)].join(_.arrayFormatSeparator)])}default:return S=>(p,w)=>w===void 0||_.skipNull&&w===null||_.skipEmptyString&&w===""?p:w===null?[...p,b(S,_)]:[...p,[b(S,_),"=",b(w,_)].join("")]}}function h(_){let S;switch(_.arrayFormat){case"index":return(p,w,f)=>{if(S=/\[(\d*)\]$/.exec(p),p=p.replace(/\[\d*\]$/,""),!S){f[p]=w;return}f[p]===void 0&&(f[p]={}),f[p][S[1]]=w};case"bracket":return(p,w,f)=>{if(S=/(\[\])$/.exec(p),p=p.replace(/\[\]$/,""),!S){f[p]=w;return}if(f[p]===void 0){f[p]=[w];return}f[p]=[].concat(f[p],w)};case"colon-list-separator":return(p,w,f)=>{if(S=/(:list)$/.exec(p),p=p.replace(/:list$/,""),!S){f[p]=w;return}if(f[p]===void 0){f[p]=[w];return}f[p]=[].concat(f[p],w)};case"comma":case"separator":return(p,w,f)=>{const n=typeof w=="string"&&w.includes(_.arrayFormatSeparator),l=typeof w=="string"&&!n&&O(w,_).includes(_.arrayFormatSeparator);w=l?O(w,_):w;const R=n||l?w.split(_.arrayFormatSeparator).map(F=>O(F,_)):w===null?w:O(w,_);f[p]=R};case"bracket-separator":return(p,w,f)=>{const n=/(\[\])$/.test(p);if(p=p.replace(/\[\]$/,""),!n){f[p]=w&&O(w,_);return}const l=w===null?[]:w.split(_.arrayFormatSeparator).map(R=>O(R,_));if(f[p]===void 0){f[p]=l;return}f[p]=[].concat(f[p],l)};default:return(p,w,f)=>{if(f[p]===void 0){f[p]=w;return}f[p]=[].concat(f[p],w)}}}function g(_){if(typeof _!="string"||_.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function b(_,S){return S.encode?S.strict?e(_):encodeURIComponent(_):_}function O(_,S){return S.decode?t(_):_}function P(_){return Array.isArray(_)?_.sort():typeof _=="object"?P(Object.keys(_)).sort((S,p)=>Number(S)-Number(p)).map(S=>_[S]):_}function D(_){const S=_.indexOf("#");return S!==-1&&(_=_.slice(0,S)),_}function A(_){let S="";const p=_.indexOf("#");return p!==-1&&(S=_.slice(p)),S}function T(_){_=D(_);const S=_.indexOf("?");return S===-1?"":_.slice(S+1)}function N(_,S){return S.parseNumbers&&!Number.isNaN(Number(_))&&typeof _=="string"&&_.trim()!==""?_=Number(_):S.parseBooleans&&_!==null&&(_.toLowerCase()==="true"||_.toLowerCase()==="false")&&(_=_.toLowerCase()==="true"),_}function j(_,S){S=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},S),g(S.arrayFormatSeparator);const p=h(S),w=Object.create(null);if(typeof _!="string"||(_=_.trim().replace(/^[?#&]/,""),!_))return w;for(const f of _.split("&")){if(f==="")continue;let[n,l]=i(S.decode?f.replace(/\+/g," "):f,"=");l=l===void 0?null:["comma","separator","bracket-separator"].includes(S.arrayFormat)?l:O(l,S),p(O(n,S),l,w)}for(const f of Object.keys(w)){const n=w[f];if(typeof n=="object"&&n!==null)for(const l of Object.keys(n))n[l]=N(n[l],S);else w[f]=N(n,S)}return S.sort===!1?w:(S.sort===!0?Object.keys(w).sort():Object.keys(w).sort(S.sort)).reduce((f,n)=>{const l=w[n];return Boolean(l)&&typeof l=="object"&&!Array.isArray(l)?f[n]=P(l):f[n]=l,f},Object.create(null))}r.extract=T,r.parse=j,r.stringify=(_,S)=>{if(!_)return"";S=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},S),g(S.arrayFormatSeparator);const p=l=>S.skipNull&&c(_[l])||S.skipEmptyString&&_[l]==="",w=o(S),f={};for(const l of Object.keys(_))p(l)||(f[l]=_[l]);const n=Object.keys(f);return S.sort!==!1&&n.sort(S.sort),n.map(l=>{const R=_[l];return R===void 0?"":R===null?b(l,S):Array.isArray(R)?R.length===0&&S.arrayFormat==="bracket-separator"?b(l,S)+"[]":R.reduce(w(l),[]).join("&"):b(l,S)+"="+b(R,S)}).filter(l=>l.length>0).join("&")},r.parseUrl=(_,S)=>{S=Object.assign({decode:!0},S);const[p,w]=i(_,"#");return Object.assign({url:p.split("?")[0]||"",query:j(T(_),S)},S&&S.parseFragmentIdentifier&&w?{fragmentIdentifier:O(w,S)}:{})},r.stringifyUrl=(_,S)=>{S=Object.assign({encode:!0,strict:!0,[u]:!0},S);const p=D(_.url).split("?")[0]||"",w=r.extract(_.url),f=r.parse(w,{sort:!1}),n=Object.assign(f,_.query);let l=r.stringify(n,S);l&&(l=`?${l}`);let R=A(_.url);return _.fragmentIdentifier&&(R=`#${S[u]?b(_.fragmentIdentifier,S):_.fragmentIdentifier}`),`${p}${l}${R}`},r.pick=(_,S,p)=>{p=Object.assign({parseFragmentIdentifier:!0,[u]:!1},p);const{url:w,query:f,fragmentIdentifier:n}=r.parseUrl(_,p);return r.stringifyUrl({url:w,query:s(f,S),fragmentIdentifier:n},p)},r.exclude=(_,S,p)=>{const w=Array.isArray(S)?f=>!S.includes(f):(f,n)=>!S(f,n);return r.pick(_,w,p)}})(pr);const Mu={waku:{publish:"waku_publish",subscribe:"waku_subscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe"},irn:{publish:"irn_publish",subscribe:"irn_subscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe"},iridium:{publish:"iridium_publish",subscribe:"iridium_subscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe"}},ua="base10",nt="base16",Ei="base64pad",Ki="utf8",la=0,Jt=1,$u=0,ks=1,Di=12,Vi=32;function ju(){const r=qi.generateKeyPair();return{privateKey:bt(r.secretKey,nt),publicKey:bt(r.publicKey,nt)}}function Si(){const r=er.randomBytes(Vi);return bt(r,nt)}function zu(r,e){const t=qi.sharedKey(yt(r,nt),yt(e,nt)),i=new lu(Jr.SHA256,t).expand(Vi);return bt(i,nt)}function qu(r){const e=Jr.hash(yt(r,nt));return bt(e,nt)}function xi(r){const e=Jr.hash(yt(r,Ki));return bt(e,nt)}function Bu(r){return yt(`${r}`,ua)}function mr(r){return Number(bt(r,ua))}function Hu(r){const e=Bu(typeof r.type<"u"?r.type:la);if(mr(e)===Jt&&typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof r.senderPublicKey<"u"?yt(r.senderPublicKey,nt):void 0,i=typeof r.iv<"u"?yt(r.iv,nt):er.randomBytes(Di),s=new ji.ChaCha20Poly1305(yt(r.symKey,nt)).seal(i,yt(r.message,Ki));return Vu({type:e,sealed:s,iv:i,senderPublicKey:t})}function Ku(r){const e=new ji.ChaCha20Poly1305(yt(r.symKey,nt)),{sealed:t,iv:i}=Gi(r.encoded),s=e.open(i,t);if(s===null)throw new Error("Failed to decrypt");return bt(s,Ki)}function Vu(r){if(mr(r.type)===Jt){if(typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return bt(zs([r.type,r.senderPublicKey,r.iv,r.sealed]),Ei)}return bt(zs([r.type,r.iv,r.sealed]),Ei)}function Gi(r){const e=yt(r,Ei),t=e.slice($u,ks),i=ks;if(mr(t)===Jt){const o=i+Vi,h=o+Di,g=e.slice(i,o),b=e.slice(o,h),O=e.slice(h);return{type:t,sealed:O,iv:b,senderPublicKey:g}}const s=i+Di,c=e.slice(i,s),u=e.slice(s);return{type:t,sealed:u,iv:c}}function Gu(r,e){const t=Gi(r);return fa({type:mr(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?bt(t.senderPublicKey,nt):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function fa(r){const e=(r==null?void 0:r.type)||la;if(e===Jt){if(typeof(r==null?void 0:r.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(r==null?void 0:r.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:r==null?void 0:r.senderPublicKey,receiverPublicKey:r==null?void 0:r.receiverPublicKey}}function Ws(r){return r.type===Jt&&typeof r.senderPublicKey=="string"&&typeof r.receiverPublicKey=="string"}var ku=Object.defineProperty,Ys=Object.getOwnPropertySymbols,Wu=Object.prototype.hasOwnProperty,Yu=Object.prototype.propertyIsEnumerable,Js=(r,e,t)=>e in r?ku(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Xs=(r,e)=>{for(var t in e||(e={}))Wu.call(e,t)&&Js(r,t,e[t]);if(Ys)for(var t of Ys(e))Yu.call(e,t)&&Js(r,t,e[t]);return r};const Ju="ReactNative",dr={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Xu="js";function da(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Zu(){return!oa()&&!!Bi()&&navigator.product===Ju}function Qu(){return!da()&&!!Bi()}function el(){return Zu()?dr.reactNative:da()?dr.node:Qu()?dr.browser:dr.unknown}function tl(r,e){let t=pr.parse(r);return t=Xs(Xs({},t),e),r=pr.stringify(t),r}function rl(){return ha()||{name:"",description:"",url:"",icons:[""]}}function il(){const r=mu();if(r===null)return"unknown";const e=r.os?r.os.replace(" ","").toLowerCase():"unknown";return r.type==="browser"?[e,r.name,r.version].join("-"):[e,r.version].join("-")}function sl(){var r;const e=el();return e===dr.browser?[e,((r=ca())==null?void 0:r.host)||"unknown"].join(":"):e}function nl(r,e,t){const i=il(),s=sl();return[[r,e].join("-"),[Xu,t].join("-"),i,s].join("/")}function al({protocol:r,version:e,relayUrl:t,sdkVersion:i,auth:s,projectId:c}){const u=t.split("?"),o=nl(r,e,i),h={auth:s,ua:o,projectId:c},g=tl(u[1]||"",h);return u[0]+"?"+g}function Ft(r,e){return r.filter(t=>e.includes(t)).length===r.length}function pa(r){return Object.fromEntries(r.entries())}function ga(r){return new Map(Object.entries(r))}function Dt(r,e){return ee.fromMiliseconds((e||Date.now())+ee.toMiliseconds(r))}function Rt(r){return ee.fromMiliseconds(Date.now())>=ee.toMiliseconds(r)}function Gt(r){const e=ee.toMiliseconds(r||ee.FIVE_MINUTES);let t,i,s;return{resolve:c=>{s&&t&&(clearTimeout(s),t(c))},reject:c=>{s&&i&&(clearTimeout(s),i(c))},done:()=>new Promise((c,u)=>{s=setTimeout(u,e),t=c,i=u})}}function ya(r,e){return new Promise(async(t,i)=>{const s=setTimeout(()=>i(),e),c=await r;clearTimeout(s),t(c)})}function ba(r,e){if(typeof e=="string"&&e.startsWith(`${r}:`))return e;if(r.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(r.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${r}`)}function ol(r){return ba("topic",r)}function cl(r){return ba("id",r)}function wa(r){const[e,t]=r.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof t=="string")i.topic=t;else if(e==="id"&&Number.isInteger(Number(t)))i.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);return i}function Fe(r,e){return`${r}${e?`:${e}`:""}`}const hl="irn";function Ii(r){return(r==null?void 0:r.relay)||{protocol:hl}}function Oi(r){const e=Mu[r];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${r}`);return e}var ul=Object.defineProperty,Zs=Object.getOwnPropertySymbols,ll=Object.prototype.hasOwnProperty,fl=Object.prototype.propertyIsEnumerable,Qs=(r,e,t)=>e in r?ul(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,dl=(r,e)=>{for(var t in e||(e={}))ll.call(e,t)&&Qs(r,t,e[t]);if(Zs)for(var t of Zs(e))fl.call(e,t)&&Qs(r,t,e[t]);return r};function pl(r,e="-"){const t={},i="relay"+e;return Object.keys(r).forEach(s=>{if(s.startsWith(i)){const c=s.replace(i,""),u=r[s];t[c]=u}}),t}function gl(r){const e=r.indexOf(":"),t=r.indexOf("?")!==-1?r.indexOf("?"):void 0,i=r.substring(0,e),s=r.substring(e+1,t).split("@"),c=typeof t<"u"?r.substring(t):"",u=pr.parse(c);return{protocol:i,topic:s[0],version:parseInt(s[1],10),symKey:u.symKey,relay:pl(u)}}function yl(r,e="-"){const t="relay",i={};return Object.keys(r).forEach(s=>{const c=t+e+s;r[s]&&(i[c]=r[s])}),i}function bl(r){return`${r.protocol}:${r.topic}@${r.version}?`+pr.stringify(dl({symKey:r.symKey},yl(r.relay)))}function vr(r){const e=[];return r.forEach(t=>{const[i,s]=t.split(":");e.push(`${i}:${s}`)}),e}function wl(r){const e=[];return Object.values(r).forEach(t=>{e.push(...vr(t.accounts))}),e}function _l(r,e){const t=[];return Object.values(r).forEach(i=>{vr(i.accounts).includes(e)&&t.push(...i.methods)}),t}function ml(r,e){const t=[];return Object.values(r).forEach(i=>{vr(i.accounts).includes(e)&&t.push(...i.events)}),t}function vl(r,e){const t=Fr(r,e);if(t)throw new Error(t.message);const i={};for(const[s,c]of Object.entries(r))i[s]={methods:c.methods,events:c.events,chains:c.accounts.map(u=>`${u.split(":")[0]}:${u.split(":")[1]}`)};return i}const El={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Dl={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function G(r,e){const{message:t,code:i}=Dl[r];return{message:e?`${t} ${e}`:t,code:i}}function qe(r,e){const{message:t,code:i}=El[r];return{message:e?`${t} ${e}`:t,code:i}}function Er(r,e){return Array.isArray(r)?typeof e<"u"&&r.length?r.every(e):!0:!1}function zr(r){return Object.getPrototypeOf(r)===Object.prototype&&Object.keys(r).length}function ft(r){return typeof r>"u"}function Xe(r,e){return e&&ft(r)?!0:typeof r=="string"&&Boolean(r.trim().length)}function ki(r,e){return e&&ft(r)?!0:typeof r=="number"&&!isNaN(r)}function Sl(r,e){const{requiredNamespaces:t}=e,i=Object.keys(r.namespaces),s=Object.keys(t);let c=!0;return Ft(s,i)?(i.forEach(u=>{const{accounts:o,methods:h,events:g}=r.namespaces[u],b=vr(o),O=t[u];(!Ft(O.chains,b)||!Ft(O.methods,h)||!Ft(O.events,g))&&(c=!1)}),c):!1}function Wi(r){return Xe(r,!1)&&r.includes(":")?r.split(":").length===2:!1}function xl(r){if(Xe(r,!1)&&r.includes(":")){const e=r.split(":");if(e.length===3){const t=e[0]+":"+e[1];return!!e[2]&&Wi(t)}}return!1}function Il(r){if(Xe(r,!1))try{return typeof new URL(r)<"u"}catch{return!1}return!1}function Ol(r){var e;return(e=r==null?void 0:r.proposer)==null?void 0:e.publicKey}function Al(r){return r==null?void 0:r.topic}function Cl(r,e){let t=null;return Xe(r==null?void 0:r.publicKey,!1)||(t=G("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}function en(r){let e=!0;return Er(r)?r.length&&(e=r.every(t=>Xe(t,!1))):e=!1,e}function Pl(r,e,t){let i=null;return Er(e)?e.forEach(s=>{i||(!Wi(s)||!s.includes(r))&&(i=qe("UNSUPPORTED_CHAINS",`${t}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):i=qe("UNSUPPORTED_CHAINS",`${t}, chains ${e} should be an array of strings conforming to "namespace:chainId" format`),i}function Tl(r,e){let t=null;return Object.entries(r).forEach(([i,s])=>{if(t)return;const c=Pl(i,s==null?void 0:s.chains,`${e} requiredNamespace`);c&&(t=c)}),t}function Nl(r,e){let t=null;return Er(r)?r.forEach(i=>{t||xl(i)||(t=qe("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):t=qe("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function Rl(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;const s=Nl(i==null?void 0:i.accounts,`${e} namespace`);s&&(t=s)}),t}function Fl(r,e){let t=null;return en(r==null?void 0:r.methods)?en(r==null?void 0:r.events)||(t=qe("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=qe("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}function _a(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;const s=Fl(i,`${e}, namespace`);s&&(t=s)}),t}function Ul(r,e){let t=null;if(r&&zr(r)){const i=_a(r,e);i&&(t=i);const s=Tl(r,e);s&&(t=s)}else t=G("MISSING_OR_INVALID",`${e}, requiredNamespaces should be an object with data`);return t}function Fr(r,e){let t=null;if(r&&zr(r)){const i=_a(r,e);i&&(t=i);const s=Rl(r,e);s&&(t=s)}else t=G("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function ma(r){return Xe(r.protocol,!0)}function Ll(r,e){let t=!1;return e&&!r?t=!0:r&&Er(r)&&r.length&&r.forEach(i=>{t=ma(i)}),t}function Ml(r){return typeof r=="number"}function st(r){return typeof r<"u"&&typeof r!==null}function $l(r){return!(!r||typeof r!="object"||!r.code||!ki(r.code,!1)||!r.message||!Xe(r.message,!1))}function jl(r){return!(ft(r)||!Xe(r.method,!1))}function zl(r){return!(ft(r)||ft(r.result)&&ft(r.error)||!ki(r.id,!1)||!Xe(r.jsonrpc,!1))}function ql(r){return!(ft(r)||!Xe(r.name,!1))}function tn(r,e){return!(!Wi(e)||!wl(r).includes(e))}function Bl(r,e,t){return Xe(t,!1)?_l(r,e).includes(t):!1}function Hl(r,e,t){return Xe(t,!1)?ml(r,e).includes(t):!1}function rn(r,e,t){let i=null;const s=Object.keys(r),c=Object.keys(e);return Ft(s,c)?s.forEach(u=>{if(i)return;const o=r[u].chains,h=vr(e[u].accounts);Ft(o,h)?Ft(r[u].methods,e[u].methods)?Ft(r[u].events,e[u].events)||(i=G("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy requiredNamespaces events for ${u}`)):i=G("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy requiredNamespaces methods for ${u}`):i=G("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy requiredNamespaces chains for ${u}`)}):i=G("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces`),i}function Kl(r,e){return ki(r,!1)&&r<=e.max&&r>=e.min}const sn=10,Vl=()=>typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:require("ws"),Gl=()=>typeof window<"u",kl=Vl();class Wl{constructor(e){if(this.url=e,this.events=new dt.EventEmitter,this.registering=!1,!us(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){if(typeof this.socket>"u")throw new Error("Connection already closed");this.socket.close(),this.onClose()}async send(e,t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Pi(e))}catch(i){this.onError(e.id,i)}}register(e=this.url){if(!us(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((i,s)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),s(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,i)=>{const s=Po.isReactNative()?void 0:{rejectUnauthorized:!To(e)},c=new kl(e,[],s);Gl()?c.onerror=u=>{const o=u;i(this.emitError(o.error))}:c.on("error",u=>{i(this.emitError(u))}),c.onopen=()=>{this.onOpen(c),t(c)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=()=>this.onClose(),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(){this.socket=void 0,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?Pn(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const i=this.parseError(t),s=i.message||i.toString(),c=Ti(e,s);this.events.emit("payload",c)}parseError(e,t=this.url){return No(e,t,"WS")}resetMaxListeners(){this.events.getMaxListeners()>sn&&this.events.setMaxListeners(sn)}emitError(e){const t=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for URL: ${this.url}`));return this.events.emit("register_error",t),t}}var qr={},Yl={get exports(){return qr},set exports(r){qr=r}};(function(r,e){var t=200,i="__lodash_hash_undefined__",s=1,c=2,u=9007199254740991,o="[object Arguments]",h="[object Array]",g="[object AsyncFunction]",b="[object Boolean]",O="[object Date]",P="[object Error]",D="[object Function]",A="[object GeneratorFunction]",T="[object Map]",N="[object Number]",j="[object Null]",_="[object Object]",S="[object Promise]",p="[object Proxy]",w="[object RegExp]",f="[object Set]",n="[object String]",l="[object Symbol]",R="[object Undefined]",F="[object WeakMap]",H="[object ArrayBuffer]",V="[object DataView]",X="[object Float32Array]",E="[object Float64Array]",C="[object Int8Array]",k="[object Int16Array]",z="[object Int32Array]",L="[object Uint8Array]",$="[object Uint8ClampedArray]",U="[object Uint16Array]",q="[object Uint32Array]",te=/[\\^$.*+?()[\]{}|]/g,B=/^\[object .+?Constructor\]$/,Z=/^(?:0|[1-9]\d*)$/,Y={};Y[X]=Y[E]=Y[C]=Y[k]=Y[z]=Y[L]=Y[$]=Y[U]=Y[q]=!0,Y[o]=Y[h]=Y[H]=Y[b]=Y[V]=Y[O]=Y[P]=Y[D]=Y[T]=Y[N]=Y[_]=Y[w]=Y[f]=Y[n]=Y[F]=!1;var Q=typeof kt=="object"&&kt&&kt.Object===Object&&kt,I=typeof self=="object"&&self&&self.Object===Object&&self,x=Q||I||Function("return this")(),m=e&&!e.nodeType&&e,a=m&&!0&&r&&!r.nodeType&&r,y=a&&a.exports===m,K=y&&Q.process,W=function(){try{return K&&K.binding&&K.binding("util")}catch{}}(),le=W&&W.isTypedArray;function be(d,v){for(var M=-1,J=d==null?0:d.length,Ie=0,ne=[];++M<J;){var Ne=d[M];v(Ne,M,d)&&(ne[Ie++]=Ne)}return ne}function de(d,v){for(var M=-1,J=v.length,Ie=d.length;++M<J;)d[Ie+M]=v[M];return d}function me(d,v){for(var M=-1,J=d==null?0:d.length;++M<J;)if(v(d[M],M,d))return!0;return!1}function Re(d,v){for(var M=-1,J=Array(d);++M<d;)J[M]=v(M);return J}function Ce(d){return function(v){return d(v)}}function ye(d,v){return d.has(v)}function pe(d,v){return d==null?void 0:d[v]}function fe(d){var v=-1,M=Array(d.size);return d.forEach(function(J,Ie){M[++v]=[Ie,J]}),M}function he(d,v){return function(M){return d(v(M))}}function ce(d){var v=-1,M=Array(d.size);return d.forEach(function(J){M[++v]=J}),M}var oe=Array.prototype,ae=Function.prototype,re=Object.prototype,ue=x["__core-js_shared__"],ge=ae.toString,ie=re.hasOwnProperty,we=function(){var d=/[^.]+$/.exec(ue&&ue.keys&&ue.keys.IE_PROTO||"");return d?"Symbol(src)_1."+d:""}(),_e=re.toString,Ee=RegExp("^"+ge.call(ie).replace(te,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),De=y?x.Buffer:void 0,ve=x.Symbol,pt=x.Uint8Array,_t=re.propertyIsEnumerable,At=oe.splice,at=ve?ve.toStringTag:void 0,$t=Object.getOwnPropertySymbols,rr=De?De.isBuffer:void 0,Sr=he(Object.keys,Object),Ue=Xt(x,"DataView"),Pe=Xt(x,"Map"),Le=Xt(x,"Promise"),Me=Xt(x,"Set"),$e=Xt(x,"WeakMap"),Te=Xt(Object,"create"),Be=zt(Ue),He=zt(Pe),Ke=zt(Le),Ve=zt(Me),Ge=zt($e),ze=ve?ve.prototype:void 0,je=ze?ze.valueOf:void 0;function Oe(d){var v=-1,M=d==null?0:d.length;for(this.clear();++v<M;){var J=d[v];this.set(J[0],J[1])}}function ke(){this.__data__=Te?Te(null):{},this.size=0}function We(d){var v=this.has(d)&&delete this.__data__[d];return this.size-=v?1:0,v}function La(d){var v=this.__data__;if(Te){var M=v[d];return M===i?void 0:M}return ie.call(v,d)?v[d]:void 0}function Ma(d){var v=this.__data__;return Te?v[d]!==void 0:ie.call(v,d)}function $a(d,v){var M=this.__data__;return this.size+=this.has(d)?0:1,M[d]=Te&&v===void 0?i:v,this}Oe.prototype.clear=ke,Oe.prototype.delete=We,Oe.prototype.get=La,Oe.prototype.has=Ma,Oe.prototype.set=$a;function St(d){var v=-1,M=d==null?0:d.length;for(this.clear();++v<M;){var J=d[v];this.set(J[0],J[1])}}function ja(){this.__data__=[],this.size=0}function za(d){var v=this.__data__,M=Ir(v,d);if(M<0)return!1;var J=v.length-1;return M==J?v.pop():At.call(v,M,1),--this.size,!0}function qa(d){var v=this.__data__,M=Ir(v,d);return M<0?void 0:v[M][1]}function Ba(d){return Ir(this.__data__,d)>-1}function Ha(d,v){var M=this.__data__,J=Ir(M,d);return J<0?(++this.size,M.push([d,v])):M[J][1]=v,this}St.prototype.clear=ja,St.prototype.delete=za,St.prototype.get=qa,St.prototype.has=Ba,St.prototype.set=Ha;function jt(d){var v=-1,M=d==null?0:d.length;for(this.clear();++v<M;){var J=d[v];this.set(J[0],J[1])}}function Ka(){this.size=0,this.__data__={hash:new Oe,map:new(Pe||St),string:new Oe}}function Va(d){var v=Or(this,d).delete(d);return this.size-=v?1:0,v}function Ga(d){return Or(this,d).get(d)}function ka(d){return Or(this,d).has(d)}function Wa(d,v){var M=Or(this,d),J=M.size;return M.set(d,v),this.size+=M.size==J?0:1,this}jt.prototype.clear=Ka,jt.prototype.delete=Va,jt.prototype.get=Ga,jt.prototype.has=ka,jt.prototype.set=Wa;function xr(d){var v=-1,M=d==null?0:d.length;for(this.__data__=new jt;++v<M;)this.add(d[v])}function Ya(d){return this.__data__.set(d,i),this}function Ja(d){return this.__data__.has(d)}xr.prototype.add=xr.prototype.push=Ya,xr.prototype.has=Ja;function Ct(d){var v=this.__data__=new St(d);this.size=v.size}function Xa(){this.__data__=new St,this.size=0}function Za(d){var v=this.__data__,M=v.delete(d);return this.size=v.size,M}function Qa(d){return this.__data__.get(d)}function eo(d){return this.__data__.has(d)}function to(d,v){var M=this.__data__;if(M instanceof St){var J=M.__data__;if(!Pe||J.length<t-1)return J.push([d,v]),this.size=++M.size,this;M=this.__data__=new jt(J)}return M.set(d,v),this.size=M.size,this}Ct.prototype.clear=Xa,Ct.prototype.delete=Za,Ct.prototype.get=Qa,Ct.prototype.has=eo,Ct.prototype.set=to;function ro(d,v){var M=Ar(d),J=!M&&wo(d),Ie=!M&&!J&&Qr(d),ne=!M&&!J&&!Ie&&cs(d),Ne=M||J||Ie||ne,Ye=Ne?Re(d.length,String):[],Je=Ye.length;for(var Ae in d)(v||ie.call(d,Ae))&&!(Ne&&(Ae=="length"||Ie&&(Ae=="offset"||Ae=="parent")||ne&&(Ae=="buffer"||Ae=="byteLength"||Ae=="byteOffset")||fo(Ae,Je)))&&Ye.push(Ae);return Ye}function Ir(d,v){for(var M=d.length;M--;)if(ss(d[M][0],v))return M;return-1}function io(d,v,M){var J=v(d);return Ar(d)?J:de(J,M(d))}function ir(d){return d==null?d===void 0?R:j:at&&at in Object(d)?uo(d):bo(d)}function es(d){return sr(d)&&ir(d)==o}function ts(d,v,M,J,Ie){return d===v?!0:d==null||v==null||!sr(d)&&!sr(v)?d!==d&&v!==v:so(d,v,M,J,ts,Ie)}function so(d,v,M,J,Ie,ne){var Ne=Ar(d),Ye=Ar(v),Je=Ne?h:Pt(d),Ae=Ye?h:Pt(v);Je=Je==o?_:Je,Ae=Ae==o?_:Ae;var ot=Je==_,gt=Ae==_,et=Je==Ae;if(et&&Qr(d)){if(!Qr(v))return!1;Ne=!0,ot=!1}if(et&&!ot)return ne||(ne=new Ct),Ne||cs(d)?rs(d,v,M,J,Ie,ne):co(d,v,Je,M,J,Ie,ne);if(!(M&s)){var ht=ot&&ie.call(d,"__wrapped__"),ut=gt&&ie.call(v,"__wrapped__");if(ht||ut){var Tt=ht?d.value():d,xt=ut?v.value():v;return ne||(ne=new Ct),Ie(Tt,xt,M,J,ne)}}return et?(ne||(ne=new Ct),ho(d,v,M,J,Ie,ne)):!1}function no(d){if(!os(d)||go(d))return!1;var v=ns(d)?Ee:B;return v.test(zt(d))}function ao(d){return sr(d)&&as(d.length)&&!!Y[ir(d)]}function oo(d){if(!yo(d))return Sr(d);var v=[];for(var M in Object(d))ie.call(d,M)&&M!="constructor"&&v.push(M);return v}function rs(d,v,M,J,Ie,ne){var Ne=M&s,Ye=d.length,Je=v.length;if(Ye!=Je&&!(Ne&&Je>Ye))return!1;var Ae=ne.get(d);if(Ae&&ne.get(v))return Ae==v;var ot=-1,gt=!0,et=M&c?new xr:void 0;for(ne.set(d,v),ne.set(v,d);++ot<Ye;){var ht=d[ot],ut=v[ot];if(J)var Tt=Ne?J(ut,ht,ot,v,d,ne):J(ht,ut,ot,d,v,ne);if(Tt!==void 0){if(Tt)continue;gt=!1;break}if(et){if(!me(v,function(xt,qt){if(!ye(et,qt)&&(ht===xt||Ie(ht,xt,M,J,ne)))return et.push(qt)})){gt=!1;break}}else if(!(ht===ut||Ie(ht,ut,M,J,ne))){gt=!1;break}}return ne.delete(d),ne.delete(v),gt}function co(d,v,M,J,Ie,ne,Ne){switch(M){case V:if(d.byteLength!=v.byteLength||d.byteOffset!=v.byteOffset)return!1;d=d.buffer,v=v.buffer;case H:return!(d.byteLength!=v.byteLength||!ne(new pt(d),new pt(v)));case b:case O:case N:return ss(+d,+v);case P:return d.name==v.name&&d.message==v.message;case w:case n:return d==v+"";case T:var Ye=fe;case f:var Je=J&s;if(Ye||(Ye=ce),d.size!=v.size&&!Je)return!1;var Ae=Ne.get(d);if(Ae)return Ae==v;J|=c,Ne.set(d,v);var ot=rs(Ye(d),Ye(v),J,Ie,ne,Ne);return Ne.delete(d),ot;case l:if(je)return je.call(d)==je.call(v)}return!1}function ho(d,v,M,J,Ie,ne){var Ne=M&s,Ye=is(d),Je=Ye.length,Ae=is(v),ot=Ae.length;if(Je!=ot&&!Ne)return!1;for(var gt=Je;gt--;){var et=Ye[gt];if(!(Ne?et in v:ie.call(v,et)))return!1}var ht=ne.get(d);if(ht&&ne.get(v))return ht==v;var ut=!0;ne.set(d,v),ne.set(v,d);for(var Tt=Ne;++gt<Je;){et=Ye[gt];var xt=d[et],qt=v[et];if(J)var hs=Ne?J(qt,xt,et,v,d,ne):J(xt,qt,et,d,v,ne);if(!(hs===void 0?xt===qt||Ie(xt,qt,M,J,ne):hs)){ut=!1;break}Tt||(Tt=et=="constructor")}if(ut&&!Tt){var Cr=d.constructor,Pr=v.constructor;Cr!=Pr&&"constructor"in d&&"constructor"in v&&!(typeof Cr=="function"&&Cr instanceof Cr&&typeof Pr=="function"&&Pr instanceof Pr)&&(ut=!1)}return ne.delete(d),ne.delete(v),ut}function is(d){return io(d,vo,lo)}function Or(d,v){var M=d.__data__;return po(v)?M[typeof v=="string"?"string":"hash"]:M.map}function Xt(d,v){var M=pe(d,v);return no(M)?M:void 0}function uo(d){var v=ie.call(d,at),M=d[at];try{d[at]=void 0;var J=!0}catch{}var Ie=_e.call(d);return J&&(v?d[at]=M:delete d[at]),Ie}var lo=$t?function(d){return d==null?[]:(d=Object(d),be($t(d),function(v){return _t.call(d,v)}))}:Eo,Pt=ir;(Ue&&Pt(new Ue(new ArrayBuffer(1)))!=V||Pe&&Pt(new Pe)!=T||Le&&Pt(Le.resolve())!=S||Me&&Pt(new Me)!=f||$e&&Pt(new $e)!=F)&&(Pt=function(d){var v=ir(d),M=v==_?d.constructor:void 0,J=M?zt(M):"";if(J)switch(J){case Be:return V;case He:return T;case Ke:return S;case Ve:return f;case Ge:return F}return v});function fo(d,v){return v=v??u,!!v&&(typeof d=="number"||Z.test(d))&&d>-1&&d%1==0&&d<v}function po(d){var v=typeof d;return v=="string"||v=="number"||v=="symbol"||v=="boolean"?d!=="__proto__":d===null}function go(d){return!!we&&we in d}function yo(d){var v=d&&d.constructor,M=typeof v=="function"&&v.prototype||re;return d===M}function bo(d){return _e.call(d)}function zt(d){if(d!=null){try{return ge.call(d)}catch{}try{return d+""}catch{}}return""}function ss(d,v){return d===v||d!==d&&v!==v}var wo=es(function(){return arguments}())?es:function(d){return sr(d)&&ie.call(d,"callee")&&!_t.call(d,"callee")},Ar=Array.isArray;function _o(d){return d!=null&&as(d.length)&&!ns(d)}var Qr=rr||Do;function mo(d,v){return ts(d,v)}function ns(d){if(!os(d))return!1;var v=ir(d);return v==D||v==A||v==g||v==p}function as(d){return typeof d=="number"&&d>-1&&d%1==0&&d<=u}function os(d){var v=typeof d;return d!=null&&(v=="object"||v=="function")}function sr(d){return d!=null&&typeof d=="object"}var cs=le?Ce(le):ao;function vo(d){return _o(d)?ro(d):oo(d)}function Eo(){return[]}function Do(){return!1}r.exports=mo})(Yl,qr);function Jl(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var c=r.charAt(s),u=c.charCodeAt(0);if(t[u]!==255)throw new TypeError(c+" is ambiguous");t[u]=s}var o=r.length,h=r.charAt(0),g=Math.log(o)/Math.log(256),b=Math.log(256)/Math.log(o);function O(A){if(A instanceof Uint8Array||(ArrayBuffer.isView(A)?A=new Uint8Array(A.buffer,A.byteOffset,A.byteLength):Array.isArray(A)&&(A=Uint8Array.from(A))),!(A instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(A.length===0)return"";for(var T=0,N=0,j=0,_=A.length;j!==_&&A[j]===0;)j++,T++;for(var S=(_-j)*b+1>>>0,p=new Uint8Array(S);j!==_;){for(var w=A[j],f=0,n=S-1;(w!==0||f<N)&&n!==-1;n--,f++)w+=256*p[n]>>>0,p[n]=w%o>>>0,w=w/o>>>0;if(w!==0)throw new Error("Non-zero carry");N=f,j++}for(var l=S-N;l!==S&&p[l]===0;)l++;for(var R=h.repeat(T);l<S;++l)R+=r.charAt(p[l]);return R}function P(A){if(typeof A!="string")throw new TypeError("Expected String");if(A.length===0)return new Uint8Array;var T=0;if(A[T]!==" "){for(var N=0,j=0;A[T]===h;)N++,T++;for(var _=(A.length-T)*g+1>>>0,S=new Uint8Array(_);A[T];){var p=t[A.charCodeAt(T)];if(p===255)return;for(var w=0,f=_-1;(p!==0||w<j)&&f!==-1;f--,w++)p+=o*S[f]>>>0,S[f]=p%256>>>0,p=p/256>>>0;if(p!==0)throw new Error("Non-zero carry");j=w,T++}if(A[T]!==" "){for(var n=_-j;n!==_&&S[n]===0;)n++;for(var l=new Uint8Array(N+(_-n)),R=N;n!==_;)l[R++]=S[n++];return l}}}function D(A){var T=P(A);if(T)return T;throw new Error(`Non-${e} character`)}return{encode:O,decodeUnsafe:P,decode:D}}var Xl=Jl,Zl=Xl;const va=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},Ql=r=>new TextEncoder().encode(r),ef=r=>new TextDecoder().decode(r);class tf{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class rf{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Ea(this,e)}}class sf{constructor(e){this.decoders=e}or(e){return Ea(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Ea=(r,e)=>new sf({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class nf{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new tf(e,t,i),this.decoder=new rf(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Xr=({name:r,prefix:e,encode:t,decode:i})=>new nf(r,e,t,i),Dr=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=Zl(t,e);return Xr({prefix:r,name:e,encode:i,decode:c=>va(s(c))})},af=(r,e,t,i)=>{const s={};for(let b=0;b<e.length;++b)s[e[b]]=b;let c=r.length;for(;r[c-1]==="=";)--c;const u=new Uint8Array(c*t/8|0);let o=0,h=0,g=0;for(let b=0;b<c;++b){const O=s[r[b]];if(O===void 0)throw new SyntaxError(`Non-${i} character`);h=h<<t|O,o+=t,o>=8&&(o-=8,u[g++]=255&h>>o)}if(o>=t||255&h<<8-o)throw new SyntaxError("Unexpected end of data");return u},of=(r,e,t)=>{const i=e[e.length-1]==="=",s=(1<<t)-1;let c="",u=0,o=0;for(let h=0;h<r.length;++h)for(o=o<<8|r[h],u+=8;u>t;)u-=t,c+=e[s&o>>u];if(u&&(c+=e[s&o<<t-u]),i)for(;c.length*t&7;)c+="=";return c},Qe=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>Xr({prefix:e,name:r,encode(s){return of(s,i,t)},decode(s){return af(s,i,t,r)}}),cf=Xr({prefix:"\0",name:"identity",encode:r=>ef(r),decode:r=>Ql(r)});var hf=Object.freeze({__proto__:null,identity:cf});const uf=Qe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var lf=Object.freeze({__proto__:null,base2:uf});const ff=Qe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var df=Object.freeze({__proto__:null,base8:ff});const pf=Dr({prefix:"9",name:"base10",alphabet:"0123456789"});var gf=Object.freeze({__proto__:null,base10:pf});const yf=Qe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),bf=Qe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var wf=Object.freeze({__proto__:null,base16:yf,base16upper:bf});const _f=Qe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),mf=Qe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),vf=Qe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Ef=Qe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Df=Qe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Sf=Qe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),xf=Qe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),If=Qe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Of=Qe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Af=Object.freeze({__proto__:null,base32:_f,base32upper:mf,base32pad:vf,base32padupper:Ef,base32hex:Df,base32hexupper:Sf,base32hexpad:xf,base32hexpadupper:If,base32z:Of});const Cf=Dr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Pf=Dr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Tf=Object.freeze({__proto__:null,base36:Cf,base36upper:Pf});const Nf=Dr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Rf=Dr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Ff=Object.freeze({__proto__:null,base58btc:Nf,base58flickr:Rf});const Uf=Qe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Lf=Qe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Mf=Qe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),$f=Qe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var jf=Object.freeze({__proto__:null,base64:Uf,base64pad:Lf,base64url:Mf,base64urlpad:$f});const Da=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),zf=Da.reduce((r,e,t)=>(r[t]=e,r),[]),qf=Da.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function Bf(r){return r.reduce((e,t)=>(e+=zf[t],e),"")}function Hf(r){const e=[];for(const t of r){const i=qf[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const Kf=Xr({prefix:"🚀",name:"base256emoji",encode:Bf,decode:Hf});var Vf=Object.freeze({__proto__:null,base256emoji:Kf}),Gf=Sa,nn=128,kf=127,Wf=~kf,Yf=Math.pow(2,31);function Sa(r,e,t){e=e||[],t=t||0;for(var i=t;r>=Yf;)e[t++]=r&255|nn,r/=128;for(;r&Wf;)e[t++]=r&255|nn,r>>>=7;return e[t]=r|0,Sa.bytes=t-i+1,e}var Jf=Ai,Xf=128,an=127;function Ai(r,i){var t=0,i=i||0,s=0,c=i,u,o=r.length;do{if(c>=o)throw Ai.bytes=0,new RangeError("Could not decode varint");u=r[c++],t+=s<28?(u&an)<<s:(u&an)*Math.pow(2,s),s+=7}while(u>=Xf);return Ai.bytes=c-i,t}var Zf=Math.pow(2,7),Qf=Math.pow(2,14),ed=Math.pow(2,21),td=Math.pow(2,28),rd=Math.pow(2,35),id=Math.pow(2,42),sd=Math.pow(2,49),nd=Math.pow(2,56),ad=Math.pow(2,63),od=function(r){return r<Zf?1:r<Qf?2:r<ed?3:r<td?4:r<rd?5:r<id?6:r<sd?7:r<nd?8:r<ad?9:10},cd={encode:Gf,decode:Jf,encodingLength:od},xa=cd;const on=(r,e,t=0)=>(xa.encode(r,e,t),e),cn=r=>xa.encodingLength(r),Ci=(r,e)=>{const t=e.byteLength,i=cn(r),s=i+cn(t),c=new Uint8Array(s+t);return on(r,c,0),on(t,c,i),c.set(e,s),new hd(r,t,e,c)};class hd{constructor(e,t,i,s){this.code=e,this.size=t,this.digest=i,this.bytes=s}}const Ia=({name:r,code:e,encode:t})=>new ud(r,e,t);class ud{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Ci(this.code,t):t.then(i=>Ci(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Oa=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),ld=Ia({name:"sha2-256",code:18,encode:Oa("SHA-256")}),fd=Ia({name:"sha2-512",code:19,encode:Oa("SHA-512")});var dd=Object.freeze({__proto__:null,sha256:ld,sha512:fd});const Aa=0,pd="identity",Ca=va,gd=r=>Ci(Aa,Ca(r)),yd={code:Aa,name:pd,encode:Ca,digest:gd};var bd=Object.freeze({__proto__:null,identity:yd});new TextEncoder,new TextDecoder;const hn={...hf,...lf,...df,...gf,...wf,...Af,...Tf,...Ff,...jf,...Vf};({...dd,...bd});function wd(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}function Pa(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const un=Pa("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),fi=Pa("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=wd(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),_d={utf8:un,"utf-8":un,hex:hn.base16,latin1:fi,ascii:fi,binary:fi,...hn};function md(r,e="utf8"){const t=_d[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r,"utf8"):t.decoder.decode(`${t.prefix}${r}`)}const Ta="wc",vd=2,Yi="core",Ut=`${Ta}@${2}:${Yi}:`,Ed={name:Yi,logger:"error"},Dd={database:":memory:"},Sd="crypto",ln="client_ed25519_seed",xd=ee.ONE_DAY,Id="keychain",Od="0.3",Ad="messages",Cd="0.3",Pd=ee.SIX_HOURS,Td="publisher",Na="irn",Nd="error",Rd="wss://relay.walletconnect.com",Fd="relayer",rt={message:"relayer_message",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Ud="_subscription",Tr={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},fn=ee.ONE_SECOND,Ld="2.3.3",Md="0.3",Et={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},$d="subscription",jd="0.3",zd=ee.FIVE_SECONDS*1e3,qd="pairing",Bd="0.3",lr={wc_pairingDelete:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ee.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ee.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:0},res:{ttl:ee.ONE_DAY,prompt:!1,tag:0}}},vt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Hd="history",Kd="0.3",Vd="expirer",lt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Gd="0.3";class kd{constructor(e,t){this.core=e,this.logger=t,this.keychain=new Map,this.name=Id,this.version=Od,this.initialized=!1,this.storagePrefix=Ut,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()},this.get=i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:c}=G("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(c)}return s},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=Se.generateChildLogger(t,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,pa(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?ga(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Wd{constructor(e,t,i){this.core=e,this.logger=t,this.name=Sd,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=s=>(this.isInitialized(),this.keychain.has(s)),this.getClientId=async()=>{this.isInitialized();const s=await this.getClientSeed(),c=Ms(s);return Zn(c.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const s=ju();return this.setPrivateKey(s.publicKey,s.privateKey)},this.signJWT=async s=>{this.isInitialized();const c=await this.getClientSeed(),u=Ms(c),o=Si();return await Zh(o,s,xd,u)},this.generateSharedKey=(s,c,u)=>{this.isInitialized();const o=this.getPrivateKey(s),h=zu(o,c);return this.setSymKey(h,u)},this.setSymKey=async(s,c)=>{this.isInitialized();const u=c||qu(s);return await this.keychain.set(u,s),u},this.deleteKeyPair=async s=>{this.isInitialized(),await this.keychain.del(s)},this.deleteSymKey=async s=>{this.isInitialized(),await this.keychain.del(s)},this.encode=async(s,c,u)=>{this.isInitialized();const o=fa(u),h=Pi(c);if(Ws(o)){const P=o.senderPublicKey,D=o.receiverPublicKey;s=await this.generateSharedKey(P,D)}const g=this.getSymKey(s),{type:b,senderPublicKey:O}=o;return Hu({type:b,symKey:g,message:h,senderPublicKey:O})},this.decode=async(s,c,u)=>{this.isInitialized();const o=Gu(c,u);if(Ws(o)){const b=o.receiverPublicKey,O=o.senderPublicKey;s=await this.generateSharedKey(b,O)}const h=this.getSymKey(s),g=Ku({symKey:h,encoded:c});return Pn(g)},this.core=e,this.logger=Se.generateChildLogger(t,this.name),this.keychain=i||new kd(this.core,this.logger)}get context(){return Se.getLoggerContext(this.logger)}getPayloadType(e){const t=Gi(e);return mr(t.type)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(ln)}catch{e=Si(),await this.keychain.set(ln,e)}return md(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Yd extends ac{constructor(e,t){super(e,t),this.logger=e,this.core=t,this.messages=new Map,this.name=Ad,this.version=Cd,this.initialized=!1,this.storagePrefix=Ut,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,s)=>{this.isInitialized();const c=xi(s);let u=this.messages.get(i);return typeof u>"u"&&(u={}),typeof u[c]<"u"||(u[c]=s,this.messages.set(i,u),await this.persist()),c},this.get=i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s},this.has=(i,s)=>{this.isInitialized();const c=this.get(i),u=xi(s);return typeof c[u]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=Se.generateChildLogger(e,this.name),this.core=t}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,pa(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?ga(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Jd extends oc{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.events=new dt.EventEmitter,this.name=Td,this.queue=new Map,this.publishTimeout=1e4,this.publish=async(i,s,c)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:c}});try{const u=(c==null?void 0:c.ttl)||Pd,o=Ii(c),h=(c==null?void 0:c.prompt)||!1,g=(c==null?void 0:c.tag)||0,b={topic:i,message:s,opts:{ttl:u,relay:o,prompt:h,tag:g}},O=xi(s);this.queue.set(O,b);try{await await ya(this.rpcPublish(i,s,u,o,h,g),this.publishTimeout),this.relayer.events.emit(rt.publish,b)}catch{this.logger.debug("Publishing Payload stalled"),this.relayer.events.emit(rt.connection_stalled);return}this.onPublish(O,b),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:c}})}catch(u){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(u),u}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.relayer=e,this.logger=Se.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return Se.getLoggerContext(this.logger)}rpcPublish(e,t,i,s,c,u){var o,h,g,b;const O={method:Oi(s.protocol).publish,params:{topic:e,message:t,ttl:i,prompt:c,tag:u}};return ft((o=O.params)==null?void 0:o.prompt)&&((h=O.params)==null||delete h.prompt),ft((g=O.params)==null?void 0:g.tag)&&((b=O.params)==null||delete b.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:O}),this.relayer.provider.request(O)}onPublish(e,t){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:t,message:i,opts:s}=e;await this.publish(t,i,s)})}registerEventListeners(){this.relayer.core.heartbeat.on(br.HEARTBEAT_EVENTS.pulse,()=>{this.checkQueue()})}}class Xd{constructor(){this.map=new Map,this.set=(e,t)=>{const i=this.get(e);this.exists(e,t)||this.map.set(e,[...i,t])},this.get=e=>this.map.get(e)||[],this.exists=(e,t)=>this.get(e).includes(t),this.delete=(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,t))return;const s=i.filter(c=>c!==t);if(!s.length){this.map.delete(e);return}this.map.set(e,s)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Zd=Object.defineProperty,Qd=Object.defineProperties,ep=Object.getOwnPropertyDescriptors,dn=Object.getOwnPropertySymbols,tp=Object.prototype.hasOwnProperty,rp=Object.prototype.propertyIsEnumerable,pn=(r,e,t)=>e in r?Zd(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Nr=(r,e)=>{for(var t in e||(e={}))tp.call(e,t)&&pn(r,t,e[t]);if(dn)for(var t of dn(e))rp.call(e,t)&&pn(r,t,e[t]);return r},di=(r,e)=>Qd(r,ep(e));class ip extends uc{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.subscriptions=new Map,this.topicMap=new Xd,this.events=new dt.EventEmitter,this.name=$d,this.version=jd,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pendingSubInterval=20,this.storagePrefix=Ut,this.subscribeTimeout=1e4,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable())},this.subscribe=async(i,s)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const c=Ii(s),u={topic:i,relay:c};this.pending.set(i,u);const o=await this.rpcSubscribe(i,c);return this.onSubscribe(o,u),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}}),o}catch(c){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(c),c}},this.unsubscribe=async(i,s)=>{this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((s,c)=>{const u=new ee.Watch;u.start(this.pendingSubscriptionWatchLabel);const o=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(o),u.stop(this.pendingSubscriptionWatchLabel),s(!0)),u.elapsed(this.pendingSubscriptionWatchLabel)>=zd&&(clearInterval(o),u.stop(this.pendingSubscriptionWatchLabel),c(!1))},this.pendingSubInterval)}),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.restart=async()=>{await this.restore(),await this.reset()},this.relayer=e,this.logger=Se.generateChildLogger(t,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,t){let i=!1;try{i=this.getSubscription(e).topic===t}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear(),this.initialized=!1}async unsubscribeByTopic(e,t){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,t)))}async unsubscribeById(e,t,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}});try{const s=Ii(i);await this.rpcUnsubscribe(e,t,s);const c=qe("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,c),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,t){const i={method:Oi(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let s;try{s=await await ya(this.relayer.provider.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(rt.connection_stalled)}return s}rpcUnsubscribe(e,t,i){const s={method:Oi(i.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.provider.request(s)}onSubscribe(e,t){this.setSubscription(e,di(Nr({},t),{id:e})),this.pending.delete(t.topic)}onResubscribe(e,t){this.addSubscription(e,di(Nr({},t),{id:e})),this.pending.delete(t.topic)}async onUnsubscribe(e,t,i){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t))}addSubscription(e,t){this.subscriptions.set(e,Nr({},t)),this.topicMap.set(t.topic,e),this.events.emit(Et.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:i}=G("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(Et.deleted,di(Nr({},i),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Et.sync)}async reset(){this.cached.length&&await Promise.all(this.cached.map(async e=>await this.resubscribe(e))),this.events.emit(Et.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:t}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async resubscribe(e){if(!this.ids.includes(e.id)){const{topic:t,relay:i}=e,s={topic:t,relay:i};this.pending.set(s.topic,s);const c=await this.rpcSubscribe(s.topic,s.relay);this.onResubscribe(c,s)}}async onConnect(){await this.restart(),this.onEnable()}onDisconnect(){this.onDisable()}checkPending(){this.relayer.transportExplicitlyClosed||this.pending.forEach(async e=>{const t=await this.rpcSubscribe(e.topic,e.relay);this.onSubscribe(t,e)})}registerEventListeners(){this.relayer.core.heartbeat.on(br.HEARTBEAT_EVENTS.pulse,()=>{this.checkPending()}),this.relayer.on(rt.connect,async()=>{await this.onConnect()}),this.relayer.on(rt.disconnect,()=>{this.onDisconnect()}),this.events.on(Et.created,async e=>{const t=Et.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()}),this.events.on(Et.deleted,async e=>{const t=Et.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}var sp=Object.defineProperty,gn=Object.getOwnPropertySymbols,np=Object.prototype.hasOwnProperty,ap=Object.prototype.propertyIsEnumerable,yn=(r,e,t)=>e in r?sp(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,op=(r,e)=>{for(var t in e||(e={}))np.call(e,t)&&yn(r,t,e[t]);if(gn)for(var t of gn(e))ap.call(e,t)&&yn(r,t,e[t]);return r};class cp extends cc{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new dt.EventEmitter,this.name=Fd,this.transportExplicitlyClosed=!1,this.initialized=!1,this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Se.generateChildLogger(e.logger,this.name):Hr(Se.getDefaultLoggerOptions({level:e.logger||Nd})),this.messages=new Yd(this.logger,e.core),this.subscriber=new ip(this,this.logger),this.publisher=new Jd(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||Rd,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.provider=await this.createProvider(),await Promise.all([this.messages.init(),this.transportOpen(),this.subscriber.init()]),this.registerEventListeners(),this.initialized=!0}get context(){return Se.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,t,i){this.isInitialized(),await this.publisher.publish(e,t,i),await this.recordMessageEvent({topic:e,message:t})}async subscribe(e,t){this.isInitialized();let i="";return await Promise.all([new Promise(s=>{this.subscriber.once(Et.created,c=>{c.topic===e&&s()})}),new Promise(async s=>{i=await this.subscriber.subscribe(e,t),s()})]),i}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(rt.transport_closed))}async transportOpen(e){this.relayUrl=e||this.relayUrl,this.transportExplicitlyClosed=!1;try{await Promise.all([new Promise(t=>{this.initialized||t(),this.subscriber.once(Et.resubscribed,()=>{t()})}),await Promise.race([this.provider.connect(),new Promise((t,i)=>this.once(rt.transport_closed,()=>{i(new Error("closeTransport called before connection was established"))}))])])}catch(t){const i=t;if(!/socket hang up/i.test(i.message))throw new Error(i.message);this.logger.error(i),this.events.emit(rt.transport_closed)}}async restartTransport(e){await this.transportClose(),await new Promise(t=>setTimeout(t,fn)),await this.transportOpen(e)}async createProvider(){const e=await this.core.crypto.signJWT(this.relayUrl);return new gr(new Wl(al({sdkVersion:Ld,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e})))}async recordMessageEvent(e){const{topic:t,message:i}=e;await this.messages.set(t,i)}async shouldIgnoreMessageEvent(e){const{topic:t,message:i}=e;return await this.subscriber.isSubscribed(t)?this.messages.has(t,i):!0}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Ni(e)){if(!e.method.endsWith(Ud))return;const t=e.params,{topic:i,message:s}=t.data,c={topic:i,message:s};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(op({type:"event",event:t.id},c)),this.events.emit(t.id,c),await this.acknowledgePayload(e),await this.onMessageEvent(c)}}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(rt.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const t=Ri(e.id,!0);await this.provider.connection.send(t)}registerEventListeners(){this.provider.on(Tr.payload,e=>this.onProviderPayload(e)),this.provider.on(Tr.connect,()=>{this.events.emit(rt.connect)}),this.provider.on(Tr.disconnect,()=>{this.events.emit(rt.disconnect),this.attemptToReconnect()}),this.provider.on(Tr.error,e=>this.events.emit(rt.error,e)),this.events.on(rt.connection_stalled,async()=>{await this.restartTransport()})}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.transportOpen()},ee.toMiliseconds(fn))}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}var hp=Object.defineProperty,bn=Object.getOwnPropertySymbols,up=Object.prototype.hasOwnProperty,lp=Object.prototype.propertyIsEnumerable,wn=(r,e,t)=>e in r?hp(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,_n=(r,e)=>{for(var t in e||(e={}))up.call(e,t)&&wn(r,t,e[t]);if(bn)for(var t of bn(e))lp.call(e,t)&&wn(r,t,e[t]);return r};class Zr extends hc{constructor(e,t,i,s=Ut,c=void 0){super(e,t,i,s),this.core=e,this.logger=t,this.name=i,this.map=new Map,this.version=Md,this.cached=[],this.initialized=!1,this.storagePrefix=Ut,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(u=>{Ol(u)?this.map.set(u.id,u):Al(u)?this.map.set(u.topic,u):this.getKey&&u!==null&&!ft(u)&&this.map.set(this.getKey(u),u)}),this.cached=[],this.initialized=!0)},this.set=async(u,o)=>{this.isInitialized(),this.map.has(u)?await this.update(u,o):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:u,value:o}),this.map.set(u,o),await this.persist())},this.get=u=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:u}),this.getData(u)),this.getAll=u=>(this.isInitialized(),u?this.values.filter(o=>Object.keys(u).every(h=>qr(o[h],u[h]))):this.values),this.update=async(u,o)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:u,update:o});const h=_n(_n({},this.getData(u)),o);this.map.set(u,h),await this.persist()},this.delete=async(u,o)=>{this.isInitialized(),this.map.has(u)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:u,reason:o}),this.map.delete(u),await this.persist())},this.logger=Se.generateChildLogger(t,this.name),this.storagePrefix=s,this.getKey=c}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){const{message:i}=G("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}class fp{constructor(e,t){this.core=e,this.logger=t,this.name=qd,this.version=Bd,this.events=new dt,this.initialized=!1,this.storagePrefix=Ut,this.ignoredPayloadTypes=[Jt],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=Si(),s=await this.core.crypto.setSymKey(i),c=Dt(ee.FIVE_MINUTES),u={protocol:Na},o={topic:s,expiry:c,relay:u,active:!1},h=bl({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:u});return await this.pairings.set(s,o),await this.core.relayer.subscribe(s),this.core.expirer.set(s,c),{topic:s,uri:h}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:s,symKey:c,relay:u}=gl(i.uri),o=Dt(ee.FIVE_MINUTES),h={topic:s,relay:u,expiry:o,active:!1};return await this.pairings.set(s,h),await this.core.crypto.setSymKey(c,s),await this.core.relayer.subscribe(s,{relay:u}),this.core.expirer.set(s,o),i.activatePairing&&await this.activate({topic:s}),h},this.activate=async({topic:i})=>{this.isInitialized();const s=Dt(ee.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:s}),this.core.expirer.set(i,s)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:s}=i;if(this.pairings.keys.includes(s)){const c=await this.sendRequest(s,"wc_pairingPing",{}),{done:u,resolve:o,reject:h}=Gt();this.events.once(Fe("pairing_ping",c),({error:g})=>{g?h(g):o()}),await u()}},this.updateExpiry=async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})},this.updateMetadata=async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",qe("USER_DISCONNECTED")),await this.deletePairing(s))},this.sendRequest=async(i,s,c)=>{const u=Fi(s,c),o=await this.core.crypto.encode(i,u),h=lr[s].req;return this.core.history.set(i,u),await this.core.relayer.publish(i,o,h),u.id},this.sendResult=async(i,s,c)=>{const u=Ri(i,c),o=await this.core.crypto.encode(s,u),h=await this.core.history.get(s,i),g=lr[h.request.method].res;await this.core.relayer.publish(s,o,g),await this.core.history.resolve(u)},this.sendError=async(i,s,c)=>{const u=Ti(i,c),o=await this.core.crypto.encode(s,u),h=await this.core.history.get(s,i),g=lr[h.request.method]?lr[h.request.method].res:lr.unregistered_method.res;await this.core.relayer.publish(s,o,g),await this.core.history.resolve(u)},this.deletePairing=async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,qe("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(s=>Rt(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))},this.onRelayEventRequest=i=>{const{topic:s,payload:c}=i,u=c.method;if(this.pairings.keys.includes(s))switch(u){case"wc_pairingPing":return this.onPairingPingRequest(s,c);case"wc_pairingDelete":return this.onPairingDeleteRequest(s,c);default:return this.onUnknownRpcMethodRequest(s,c)}},this.onRelayEventResponse=async i=>{const{topic:s,payload:c}=i,u=(await this.core.history.get(s,c.id)).request.method;if(this.pairings.keys.includes(s))switch(u){case"wc_pairingPing":return this.onPairingPingResponse(s,c);default:return this.onUnknownRpcMethodResponse(u)}},this.onPairingPingRequest=async(i,s)=>{const{id:c}=s;try{this.isValidPing({topic:i}),await this.sendResult(c,i,!0),this.events.emit("pairing_ping",{id:c,topic:i})}catch(u){await this.sendError(c,i,u),this.logger.error(u)}},this.onPairingPingResponse=(i,s)=>{const{id:c}=s;setTimeout(()=>{Nt(s)?this.events.emit(Fe("pairing_ping",c),{}):Ot(s)&&this.events.emit(Fe("pairing_ping",c),{error:s.error})},500)},this.onPairingDeleteRequest=async(i,s)=>{const{id:c}=s;try{this.isValidDisconnect({topic:i}),await this.sendResult(c,i,!0),await this.deletePairing(i),this.events.emit("pairing_delete",{id:c,topic:i})}catch(u){await this.sendError(c,i,u),this.logger.error(u)}},this.onUnknownRpcMethodRequest=async(i,s)=>{const{id:c,method:u}=s;try{if(this.registeredMethods.includes(u))return;const o=qe("WC_METHOD_UNSUPPORTED",u);await this.sendError(c,i,o),this.logger.error(o)}catch(o){await this.sendError(c,i,o),this.logger.error(o)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(qe("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{if(!st(i)){const{message:s}=G("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(s)}if(!Il(i.uri)){const{message:s}=G("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(s)}},this.isValidPing=async i=>{if(!st(i)){const{message:c}=G("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(c)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidDisconnect=async i=>{if(!st(i)){const{message:c}=G("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(c)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidPairingTopic=async i=>{if(!Xe(i,!1)){const{message:s}=G("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=G("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if(Rt(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=G("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}},this.core=e,this.logger=Se.generateChildLogger(t,this.name),this.pairings=new Zr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Se.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(rt.message,async e=>{const{topic:t,message:i}=e;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const s=await this.core.crypto.decode(t,i);Ni(s)?(this.core.history.set(t,s),this.onRelayEventRequest({topic:t,payload:s})):Tn(s)&&(await this.core.history.resolve(s),this.onRelayEventResponse({topic:t,payload:s}))})}registerExpirerEvents(){this.core.expirer.on(lt.expired,async e=>{const{topic:t}=wa(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit("pairing_expire",{topic:t}))})}}class dp extends nc{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.records=new Map,this.events=new dt.EventEmitter,this.name=Hd,this.version=Kd,this.cached=[],this.initialized=!1,this.storagePrefix=Ut,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,s,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:c}),this.records.has(s.id))return;const u={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:c};this.records.set(u.id,u),this.events.emit(vt.created,u)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=Ot(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.events.emit(vt.updated,s))},this.get=async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s)),this.delete=(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(c=>{if(c.topic===i){if(typeof s<"u"&&c.id!==s)return;this.records.delete(c.id),this.events.emit(vt.deleted,c)}})},this.exists=async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=Se.generateChildLogger(t,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const i={topic:t.topic,request:Fi(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:i}=G("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(vt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(vt.created,e=>{const t=vt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(vt.updated,e=>{const t=vt.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(vt.deleted,e=>{const t=vt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}class pp extends lc{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.expirations=new Map,this.events=new dt.EventEmitter,this.name=Vd,this.version=Gd,this.cached=[],this.initialized=!1,this.storagePrefix=Ut,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}},this.set=(i,s)=>{this.isInitialized();const c=this.formatTarget(i),u={target:c,expiry:s};this.expirations.set(c,u),this.checkExpiry(c,u),this.events.emit(lt.created,{target:c,expiration:u})},this.get=i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)},this.del=i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),c=this.getExpiration(s);this.expirations.delete(s),this.events.emit(lt.deleted,{target:s,expiration:c})}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=Se.generateChildLogger(t,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return ol(e);if(typeof e=="number")return cl(e);const{message:t}=G("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(lt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:i}=G("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}checkExpiry(e,t){const{expiry:i}=t;ee.toMiliseconds(i)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(lt.expired,{target:e,expiration:t})}checkExpirations(){this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(br.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(lt.created,e=>{const t=lt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(lt.expired,e=>{const t=lt.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(lt.deleted,e=>{const t=lt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}var gp=Object.defineProperty,mn=Object.getOwnPropertySymbols,yp=Object.prototype.hasOwnProperty,bp=Object.prototype.propertyIsEnumerable,vn=(r,e,t)=>e in r?gp(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,En=(r,e)=>{for(var t in e||(e={}))yp.call(e,t)&&vn(r,t,e[t]);if(mn)for(var t of mn(e))bp.call(e,t)&&vn(r,t,e[t]);return r};class Ji extends sc{constructor(e){super(e),this.protocol=Ta,this.version=vd,this.name=Yi,this.events=new dt.EventEmitter,this.initialized=!1,this.on=(i,s)=>this.events.on(i,s),this.once=(i,s)=>this.events.once(i,s),this.off=(i,s)=>this.events.off(i,s),this.removeListener=(i,s)=>this.events.removeListener(i,s),this.projectId=e==null?void 0:e.projectId;const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Hr(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Ed.logger}));this.logger=Se.generateChildLogger(t,this.name),this.heartbeat=new br.HeartBeat,this.crypto=new Wd(this,this.logger,e==null?void 0:e.keychain),this.history=new dp(this,this.logger),this.expirer=new pp(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Ho(En(En({},Dd),e==null?void 0:e.storageOptions)),this.relayer=new cp({core:this,logger:this.logger,relayUrl:e==null?void 0:e.relayUrl,projectId:this.projectId}),this.pairing=new fp(this,this.logger)}static async init(e){const t=new Ji(e);return await t.initialize(),t}get context(){return Se.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const wp=Ji,Ra="wc",Fa=2,Ua="client",Xi=`${Ra}@${Fa}:${Ua}:`,pi={name:Ua,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},_p="proposal",mp="session",Rr=ee.SEVEN_DAYS,vp="engine",fr={wc_sessionPropose:{req:{ttl:ee.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ee.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ee.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ee.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:ee.THIRTY_SECONDS,prompt:!1,tag:1115}}},gi={min:ee.FIVE_MINUTES,max:ee.SEVEN_DAYS},Ep="request";var Dp=Object.defineProperty,Sp=Object.defineProperties,xp=Object.getOwnPropertyDescriptors,Dn=Object.getOwnPropertySymbols,Ip=Object.prototype.hasOwnProperty,Op=Object.prototype.propertyIsEnumerable,Sn=(r,e,t)=>e in r?Dp(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,It=(r,e)=>{for(var t in e||(e={}))Ip.call(e,t)&&Sn(r,t,e[t]);if(Dn)for(var t of Dn(e))Op.call(e,t)&&Sn(r,t,e[t]);return r},yi=(r,e)=>Sp(r,xp(e));class Ap extends dc{constructor(e){super(e),this.name=vp,this.events=new dt,this.initialized=!1,this.ignoredPayloadTypes=[Jt],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(fr)}),this.initialized=!0)},this.connect=async t=>{this.isInitialized(),await this.isValidConnect(t);const{pairingTopic:i,requiredNamespaces:s,relays:c}=t;let u=i,o,h=!1;if(u&&(h=this.client.core.pairing.pairings.get(u).active),!u||!h){const{topic:N,uri:j}=await this.client.core.pairing.create();u=N,o=j}const g=await this.client.core.crypto.generateKeyPair(),b={requiredNamespaces:s,relays:c??[{protocol:Na}],proposer:{publicKey:g,metadata:this.client.metadata}},{reject:O,resolve:P,done:D}=Gt();if(this.events.once(Fe("session_connect"),async({error:N,session:j})=>{if(N)O(N);else if(j){j.self.publicKey=g;const _=yi(It({},j),{requiredNamespaces:j.requiredNamespaces});await this.client.session.set(j.topic,_),await this.setExpiry(j.topic,j.expiry),u&&await this.client.core.pairing.updateMetadata({topic:u,metadata:j.peer.metadata}),P(_)}}),!u){const{message:N}=G("NO_MATCHING_KEY",`connect() pairing topic: ${u}`);throw new Error(N)}const A=await this.sendRequest(u,"wc_sessionPropose",b),T=Dt(ee.FIVE_MINUTES);return await this.setProposal(A,It({id:A,expiry:T},b)),{uri:o,approval:D}},this.pair=async t=>(this.isInitialized(),await this.client.core.pairing.pair(t)),this.approve=async t=>{this.isInitialized(),await this.isValidApprove(t);const{id:i,relayProtocol:s,namespaces:c}=t,u=this.client.proposal.get(i);let{pairingTopic:o,proposer:h,requiredNamespaces:g}=u;zr(g)||(g=vl(c,"approve()"),this.client.proposal.set(i,yi(It({},u),{requiredNamespaces:g})));const b=await this.client.core.crypto.generateKeyPair(),O=h.publicKey,P=await this.client.core.crypto.generateSharedKey(b,O),D={relay:{protocol:s??"irn"},namespaces:c,requiredNamespaces:g,controller:{publicKey:b,metadata:this.client.metadata},expiry:Dt(Rr)};await this.client.core.relayer.subscribe(P);const A=await this.sendRequest(P,"wc_sessionSettle",D),{done:T,resolve:N,reject:j}=Gt();this.events.once(Fe("session_approve",A),({error:S})=>{S?j(S):N(this.client.session.get(P))});const _=yi(It({},D),{topic:P,acknowledged:!1,self:D.controller,peer:{publicKey:h.publicKey,metadata:h.metadata},controller:b});return await this.client.session.set(P,_),await this.setExpiry(P,Dt(Rr)),o&&await this.client.core.pairing.updateMetadata({topic:o,metadata:_.peer.metadata}),o&&i&&(await this.sendResult(i,o,{relay:{protocol:s??"irn"},responderPublicKey:b}),await this.client.proposal.delete(i,qe("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:o})),{topic:P,acknowledged:T}},this.reject=async t=>{this.isInitialized(),await this.isValidReject(t);const{id:i,reason:s}=t,{pairingTopic:c}=this.client.proposal.get(i);c&&(await this.sendError(i,c,s),await this.client.proposal.delete(i,qe("USER_DISCONNECTED")))},this.update=async t=>{this.isInitialized(),await this.isValidUpdate(t);const{topic:i,namespaces:s}=t,c=await this.sendRequest(i,"wc_sessionUpdate",{namespaces:s}),{done:u,resolve:o,reject:h}=Gt();return this.events.once(Fe("session_update",c),({error:g})=>{g?h(g):o()}),await this.client.session.update(i,{namespaces:s}),{acknowledged:u}},this.extend=async t=>{this.isInitialized(),await this.isValidExtend(t);const{topic:i}=t,s=await this.sendRequest(i,"wc_sessionExtend",{}),{done:c,resolve:u,reject:o}=Gt();return this.events.once(Fe("session_extend",s),({error:h})=>{h?o(h):u()}),await this.setExpiry(i,Dt(Rr)),{acknowledged:c}},this.request=async t=>{this.isInitialized(),await this.isValidRequest(t);const{chainId:i,request:s,topic:c,expiry:u}=t,o=await this.sendRequest(c,"wc_sessionRequest",{request:s,chainId:i},u),{done:h,resolve:g,reject:b}=Gt(u);return this.events.once(Fe("session_request",o),({error:O,result:P})=>{O?b(O):g(P)}),await h()},this.respond=async t=>{this.isInitialized(),await this.isValidRespond(t);const{topic:i,response:s}=t,{id:c}=s;Nt(s)?await this.sendResult(c,i,s.result):Ot(s)&&await this.sendError(c,i,s.error),this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0})},this.ping=async t=>{this.isInitialized(),await this.isValidPing(t);const{topic:i}=t;if(this.client.session.keys.includes(i)){const s=await this.sendRequest(i,"wc_sessionPing",{}),{done:c,resolve:u,reject:o}=Gt();this.events.once(Fe("session_ping",s),({error:h})=>{h?o(h):u()}),await c()}else this.client.core.pairing.pairings.keys.includes(i)&&await this.client.core.pairing.ping({topic:i})},this.emit=async t=>{this.isInitialized(),await this.isValidEmit(t);const{topic:i,event:s,chainId:c}=t;await this.sendRequest(i,"wc_sessionEvent",{event:s,chainId:c})},this.disconnect=async t=>{this.isInitialized(),await this.isValidDisconnect(t);const{topic:i}=t;this.client.session.keys.includes(i)?(await this.sendRequest(i,"wc_sessionDelete",qe("USER_DISCONNECTED")),await this.deleteSession(i)):await this.client.core.pairing.disconnect({topic:i})},this.find=t=>(this.isInitialized(),this.client.session.getAll().filter(i=>Sl(i,t))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.deleteSession=async(t,i)=>{const{self:s}=this.client.session.get(t);await this.client.core.relayer.unsubscribe(t),await Promise.all([this.client.session.delete(t,qe("USER_DISCONNECTED")),this.client.core.crypto.deleteKeyPair(s.publicKey),this.client.core.crypto.deleteSymKey(t),i?Promise.resolve():this.client.core.expirer.del(t)])},this.deleteProposal=async(t,i)=>{await Promise.all([this.client.proposal.delete(t,qe("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(t)])},this.deletePendingSessionRequest=async(t,i,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,i),s?Promise.resolve():this.client.core.expirer.del(t)])},this.setExpiry=async(t,i)=>{this.client.session.keys.includes(t)&&await this.client.session.update(t,{expiry:i}),this.client.core.expirer.set(t,i)},this.setProposal=async(t,i)=>{await this.client.proposal.set(t,i),this.client.core.expirer.set(t,i.expiry)},this.setPendingSessionRequest=async t=>{const i=fr.wc_sessionRequest.req.ttl,{id:s,topic:c,params:u}=t;await this.client.pendingRequest.set(s,{id:s,topic:c,params:u}),i&&this.client.core.expirer.set(s,Dt(i))},this.sendRequest=async(t,i,s,c)=>{const u=Fi(i,s),o=await this.client.core.crypto.encode(t,u),h=fr[i].req;return c&&(h.ttl=c),this.client.core.history.set(t,u),this.client.core.relayer.publish(t,o,h),u.id},this.sendResult=async(t,i,s)=>{const c=Ri(t,s),u=await this.client.core.crypto.encode(i,c),o=await this.client.core.history.get(i,t),h=fr[o.request.method].res;this.client.core.relayer.publish(i,u,h),await this.client.core.history.resolve(c)},this.sendError=async(t,i,s)=>{const c=Ti(t,s),u=await this.client.core.crypto.encode(i,c),o=await this.client.core.history.get(i,t),h=fr[o.request.method].res;this.client.core.relayer.publish(i,u,h),await this.client.core.history.resolve(c)},this.cleanup=async()=>{const t=[],i=[];this.client.session.getAll().forEach(s=>{Rt(s.expiry)&&t.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{Rt(s.expiry)&&i.push(s.id)}),await Promise.all([...t.map(s=>this.deleteSession(s)),...i.map(s=>this.deleteProposal(s))])},this.onRelayEventRequest=t=>{const{topic:i,payload:s}=t,c=s.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeRequest(i,s);case"wc_sessionSettle":return this.onSessionSettleRequest(i,s);case"wc_sessionUpdate":return this.onSessionUpdateRequest(i,s);case"wc_sessionExtend":return this.onSessionExtendRequest(i,s);case"wc_sessionPing":return this.onSessionPingRequest(i,s);case"wc_sessionDelete":return this.onSessionDeleteRequest(i,s);case"wc_sessionRequest":return this.onSessionRequest(i,s);case"wc_sessionEvent":return this.onSessionEventRequest(i,s);default:return this.client.logger.info(`Unsupported request method ${c}`)}},this.onRelayEventResponse=async t=>{const{topic:i,payload:s}=t,c=(await this.client.core.history.get(i,s.id)).request.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeResponse(i,s);case"wc_sessionSettle":return this.onSessionSettleResponse(i,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,s);case"wc_sessionExtend":return this.onSessionExtendResponse(i,s);case"wc_sessionPing":return this.onSessionPingResponse(i,s);case"wc_sessionRequest":return this.onSessionRequestResponse(i,s);default:return this.client.logger.info(`Unsupported response method ${c}`)}},this.onSessionProposeRequest=async(t,i)=>{const{params:s,id:c}=i;try{this.isValidConnect(It({},i.params));const u=Dt(ee.FIVE_MINUTES),o=It({id:c,pairingTopic:t,expiry:u},s);await this.setProposal(c,o),this.client.events.emit("session_proposal",{id:c,params:o})}catch(u){await this.sendError(c,t,u),this.client.logger.error(u)}},this.onSessionProposeResponse=async(t,i)=>{const{id:s}=i;if(Nt(i)){const{result:c}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:c});const u=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:u});const o=u.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:o});const h=c.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:h});const g=await this.client.core.crypto.generateSharedKey(o,h);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:g});const b=await this.client.core.relayer.subscribe(g);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:b}),await this.client.core.pairing.activate({topic:t})}else Ot(i)&&(await this.client.proposal.delete(s,qe("USER_DISCONNECTED")),this.events.emit(Fe("session_connect"),{error:i.error}))},this.onSessionSettleRequest=async(t,i)=>{const{id:s,params:c}=i;try{this.isValidSessionSettleRequest(c);const{relay:u,controller:o,expiry:h,namespaces:g,requiredNamespaces:b}=i.params,O={topic:t,relay:u,expiry:h,namespaces:g,acknowledged:!0,requiredNamespaces:b,controller:o.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:o.publicKey,metadata:o.metadata}};await this.sendResult(i.id,t,!0),this.events.emit(Fe("session_connect"),{session:O})}catch(u){await this.sendError(s,t,u),this.client.logger.error(u)}},this.onSessionSettleResponse=async(t,i)=>{const{id:s}=i;Nt(i)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(Fe("session_approve",s),{})):Ot(i)&&(await this.client.session.delete(t,qe("USER_DISCONNECTED")),this.events.emit(Fe("session_approve",s),{error:i.error}))},this.onSessionUpdateRequest=async(t,i)=>{const{params:s,id:c}=i;try{this.isValidUpdate(It({topic:t},s)),await this.client.session.update(t,{namespaces:s.namespaces}),await this.sendResult(c,t,!0),this.client.events.emit("session_update",{id:c,topic:t,params:s})}catch(u){await this.sendError(c,t,u),this.client.logger.error(u)}},this.onSessionUpdateResponse=(t,i)=>{const{id:s}=i;Nt(i)?this.events.emit(Fe("session_update",s),{}):Ot(i)&&this.events.emit(Fe("session_update",s),{error:i.error})},this.onSessionExtendRequest=async(t,i)=>{const{id:s}=i;try{this.isValidExtend({topic:t}),await this.setExpiry(t,Dt(Rr)),await this.sendResult(s,t,!0),this.client.events.emit("session_extend",{id:s,topic:t})}catch(c){await this.sendError(s,t,c),this.client.logger.error(c)}},this.onSessionExtendResponse=(t,i)=>{const{id:s}=i;Nt(i)?this.events.emit(Fe("session_extend",s),{}):Ot(i)&&this.events.emit(Fe("session_extend",s),{error:i.error})},this.onSessionPingRequest=async(t,i)=>{const{id:s}=i;try{this.isValidPing({topic:t}),await this.sendResult(s,t,!0),this.client.events.emit("session_ping",{id:s,topic:t})}catch(c){await this.sendError(s,t,c),this.client.logger.error(c)}},this.onSessionPingResponse=(t,i)=>{const{id:s}=i;setTimeout(()=>{Nt(i)?this.events.emit(Fe("session_ping",s),{}):Ot(i)&&this.events.emit(Fe("session_ping",s),{error:i.error})},500)},this.onSessionDeleteRequest=async(t,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:t,reason:i.params}),this.client.core.relayer.once(rt.publish,async()=>{await this.deleteSession(t)}),await this.sendResult(s,t,!0),this.client.events.emit("session_delete",{id:s,topic:t})}catch(c){await this.sendError(s,t,c),this.client.logger.error(c)}},this.onSessionRequest=async(t,i)=>{const{id:s,params:c}=i;try{this.isValidRequest(It({topic:t},c)),await this.setPendingSessionRequest({id:s,topic:t,params:c}),this.client.events.emit("session_request",{id:s,topic:t,params:c})}catch(u){await this.sendError(s,t,u),this.client.logger.error(u)}},this.onSessionRequestResponse=(t,i)=>{const{id:s}=i;Nt(i)?this.events.emit(Fe("session_request",s),{result:i.result}):Ot(i)&&this.events.emit(Fe("session_request",s),{error:i.error})},this.onSessionEventRequest=async(t,i)=>{const{id:s,params:c}=i;try{this.isValidEmit(It({topic:t},c)),this.client.events.emit("session_event",{id:s,topic:t,params:c})}catch(u){await this.sendError(s,t,u),this.client.logger.error(u)}},this.isValidConnect=async t=>{if(!st(t)){const{message:o}=G("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(o)}const{pairingTopic:i,requiredNamespaces:s,relays:c}=t;if(ft(i)||await this.isValidPairingTopic(i),!ft(s)&&zr(s)===0)return;const u=Ul(s,"connect()");if(u)throw new Error(u.message);if(!Ll(c,!0)){const{message:o}=G("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(o)}},this.isValidApprove=async t=>{if(!st(t))throw new Error(G("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:i,namespaces:s,relayProtocol:c}=t;await this.isValidProposalId(i);const u=this.client.proposal.get(i),o=Fr(s,"approve()");if(o)throw new Error(o.message);const h=rn(u.requiredNamespaces,s,"update()");if(h)throw new Error(h.message);if(!Xe(c,!0)){const{message:g}=G("MISSING_OR_INVALID",`approve() relayProtocol: ${c}`);throw new Error(g)}},this.isValidReject=async t=>{if(!st(t)){const{message:c}=G("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(c)}const{id:i,reason:s}=t;if(await this.isValidProposalId(i),!$l(s)){const{message:c}=G("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(c)}},this.isValidSessionSettleRequest=t=>{if(!st(t)){const{message:g}=G("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(g)}const{relay:i,controller:s,namespaces:c,expiry:u}=t;if(!ma(i)){const{message:g}=G("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(g)}const o=Cl(s,"onSessionSettleRequest()");if(o)throw new Error(o.message);const h=Fr(c,"onSessionSettleRequest()");if(h)throw new Error(h.message);if(Rt(u)){const{message:g}=G("EXPIRED","onSessionSettleRequest()");throw new Error(g)}},this.isValidUpdate=async t=>{if(!st(t)){const{message:h}=G("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(h)}const{topic:i,namespaces:s}=t;await this.isValidSessionTopic(i);const c=this.client.session.get(i),u=Fr(s,"update()");if(u)throw new Error(u.message);const o=rn(c.requiredNamespaces,s,"update()");if(o)throw new Error(o.message)},this.isValidExtend=async t=>{if(!st(t)){const{message:s}=G("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(s)}const{topic:i}=t;await this.isValidSessionTopic(i)},this.isValidRequest=async t=>{if(!st(t)){const{message:h}=G("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(h)}const{topic:i,request:s,chainId:c,expiry:u}=t;await this.isValidSessionTopic(i);const{namespaces:o}=this.client.session.get(i);if(!tn(o,c)){const{message:h}=G("MISSING_OR_INVALID",`request() chainId: ${c}`);throw new Error(h)}if(!jl(s)){const{message:h}=G("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(h)}if(!Bl(o,c,s.method)){const{message:h}=G("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(h)}if(u&&!Kl(u,gi)){const{message:h}=G("MISSING_OR_INVALID",`request() expiry: ${u}. Expiry must be a number (in seconds) between ${gi.min} and ${gi.max}`);throw new Error(h)}},this.isValidRespond=async t=>{if(!st(t)){const{message:c}=G("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(c)}const{topic:i,response:s}=t;if(await this.isValidSessionTopic(i),!zl(s)){const{message:c}=G("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(c)}},this.isValidPing=async t=>{if(!st(t)){const{message:s}=G("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(s)}const{topic:i}=t;await this.isValidSessionOrPairingTopic(i)},this.isValidEmit=async t=>{if(!st(t)){const{message:o}=G("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(o)}const{topic:i,event:s,chainId:c}=t;await this.isValidSessionTopic(i);const{namespaces:u}=this.client.session.get(i);if(!tn(u,c)){const{message:o}=G("MISSING_OR_INVALID",`emit() chainId: ${c}`);throw new Error(o)}if(!ql(s)){const{message:o}=G("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(o)}if(!Hl(u,c,s.name)){const{message:o}=G("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(o)}},this.isValidDisconnect=async t=>{if(!st(t)){const{message:s}=G("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(s)}const{topic:i}=t;await this.isValidSessionOrPairingTopic(i)}}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.client.core.relayer.on(rt.message,async e=>{const{topic:t,message:i}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(i)))return;const s=await this.client.core.crypto.decode(t,i);Ni(s)?(this.client.core.history.set(t,s),this.onRelayEventRequest({topic:t,payload:s})):Tn(s)&&(await this.client.core.history.resolve(s),this.onRelayEventResponse({topic:t,payload:s}))})}registerExpirerEvents(){this.client.core.expirer.on(lt.expired,async e=>{const{topic:t,id:i}=wa(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,G("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession(t,!0),this.client.events.emit("session_expire",{topic:t})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}isValidPairingTopic(e){if(!Xe(e,!1)){const{message:t}=G("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=G("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(Rt(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=G("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!Xe(e,!1)){const{message:t}=G("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(!this.client.session.keys.includes(e)){const{message:t}=G("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(Rt(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:t}=G("EXPIRED",`session topic: ${e}`);throw new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Xe(e,!1)){const{message:t}=G("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{const{message:t}=G("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}async isValidProposalId(e){if(!Ml(e)){const{message:t}=G("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=G("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(Rt(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:t}=G("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}}class Cp extends Zr{constructor(e,t){super(e,t,_p,Xi),this.core=e,this.logger=t}}class Pp extends Zr{constructor(e,t){super(e,t,mp,Xi),this.core=e,this.logger=t}}class Tp extends Zr{constructor(e,t){super(e,t,Ep,Xi),this.core=e,this.logger=t}}class Zi extends fc{constructor(e){super(e),this.protocol=Ra,this.version=Fa,this.name=pi.name,this.events=new dt.EventEmitter,this.on=(i,s)=>this.events.on(i,s),this.once=(i,s)=>this.events.once(i,s),this.off=(i,s)=>this.events.off(i,s),this.removeListener=(i,s)=>this.events.removeListener(i,s),this.removeAllListeners=i=>this.events.removeAllListeners(i),this.connect=async i=>{try{return await this.engine.connect(i)}catch(s){throw this.logger.error(s.message),s}},this.pair=async i=>{try{return await this.engine.pair(i)}catch(s){throw this.logger.error(s.message),s}},this.approve=async i=>{try{return await this.engine.approve(i)}catch(s){throw this.logger.error(s.message),s}},this.reject=async i=>{try{return await this.engine.reject(i)}catch(s){throw this.logger.error(s.message),s}},this.update=async i=>{try{return await this.engine.update(i)}catch(s){throw this.logger.error(s.message),s}},this.extend=async i=>{try{return await this.engine.extend(i)}catch(s){throw this.logger.error(s.message),s}},this.request=async i=>{try{return await this.engine.request(i)}catch(s){throw this.logger.error(s.message),s}},this.respond=async i=>{try{return await this.engine.respond(i)}catch(s){throw this.logger.error(s.message),s}},this.ping=async i=>{try{return await this.engine.ping(i)}catch(s){throw this.logger.error(s.message),s}},this.emit=async i=>{try{return await this.engine.emit(i)}catch(s){throw this.logger.error(s.message),s}},this.disconnect=async i=>{try{return await this.engine.disconnect(i)}catch(s){throw this.logger.error(s.message),s}},this.find=i=>{try{return this.engine.find(i)}catch(s){throw this.logger.error(s.message),s}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}},this.name=(e==null?void 0:e.name)||pi.name,this.metadata=(e==null?void 0:e.metadata)||rl();const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Hr(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||pi.logger}));this.core=(e==null?void 0:e.core)||new wp(e),this.logger=Se.generateChildLogger(t,this.name),this.session=new Pp(this.core,this.logger),this.proposal=new Cp(this.core,this.logger),this.pendingRequest=new Tp(this.core,this.logger),this.engine=new Ap(this)}static async init(e){const t=new Zi(e);return await t.initialize(),t}get context(){return Se.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}function Np(r){var e;const t=(e=r[Object.keys(r)[0]])==null?void 0:e.chains[0];return[t.split(":")[0],t.split(":")[1]]}function Lt(r,e){let t;return e.rpcMap&&(t=e.rpcMap[Rp([r])]),t}function Rp(r){return Number(r[0].split(":")[1])}class Fp{constructor(e){this.name="eip155",this.namespace=e.namespace,this.client=e.client,this.events=e.events,this.httpProviders=this.createHttpProviders(),this.chainId=this.getDefaultChainId()}async request(e){var t;switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":{const i=e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0";return this.setDefaultChain(parseInt(i,16).toString()),null}case"eth_chainId":return this.getDefaultChainId()}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){if(this.chainId=parseInt(e),!this.httpProviders[e]){const i=t||Lt(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}requestAccounts(){return this.getAccounts()}createHttpProvider(e,t){const i=t||Lt(e,this.namespace);return typeof i>"u"?void 0:new gr(new Br(i))}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return parseInt(e.split(":")[1])}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}}class Up{constructor(e){this.name="solana",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||Lt(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Lt(e,this.namespace);return typeof i>"u"?void 0:new gr(new Br(i))}}class Lp{constructor(e){this.name="cosmos",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||Lt(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Lt(e,this.namespace);return typeof i>"u"?void 0:new gr(new Br(i))}}class Mp{constructor(e){this.name="cip34",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||Lt(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Lt(e,this.namespace);return typeof i>"u"?void 0:new gr(new Br(i))}}const xn="error",$p="wss://relay.walletconnect.com",jp="wc",zp="universal_provider",In=`${jp}@${2}:${zp}:`;var qp=Object.defineProperty,Bp=Object.defineProperties,Hp=Object.getOwnPropertyDescriptors,On=Object.getOwnPropertySymbols,Kp=Object.prototype.hasOwnProperty,Vp=Object.prototype.propertyIsEnumerable,An=(r,e,t)=>e in r?qp(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Cn=(r,e)=>{for(var t in e||(e={}))Kp.call(e,t)&&An(r,t,e[t]);if(On)for(var t of On(e))Vp.call(e,t)&&An(r,t,e[t]);return r},Gp=(r,e)=>Bp(r,Hp(e));class Qi{constructor(e){this.events=new dt,this.rpcProviders={},this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Hr(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||xn}))}static async init(e){const t=new Qi(e);return await t.initialize(),t}async request(e,t){const[i,s]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(i).request({request:Cn({},e),chainId:`${i}:${s}`,topic:this.session.topic})}sendAsync(e,t,i){this.request(e,i).then(s=>t(null,s)).catch(s=>t(s,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:qe("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");const{namespaces:t}=e;return this.setNamespaces(t),this.createProviders(),await this.cleanupPendingPairings(),e.skipPairing===!0?void 0:await this.pair(e.pairingTopic)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){const{uri:t,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces});return t&&(this.uri=t,this.events.emit("display_uri",t)),this.session=await i(),this.onSessionUpdate(),this.onConnect(),this.session}setDefaultChain(e,t){try{const[i,s]=this.validateChain(e);this.getProvider(i).setDefaultChain(s,t)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(Er(t)){for(const i of t)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}async checkStorage(){if(this.namespaces=await this.client.core.storage.getItem(`${In}/namespaces`)||{},this.namespaces&&this.createProviders(),this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.onSessionUpdate()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await Zi.init({logger:this.providerOpts.logger||xn,relayUrl:this.providerOpts.relayUrl||$p,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");Object.keys(this.namespaces).forEach(e=>{switch(e){case"eip155":this.rpcProviders[e]=new Fp({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"solana":this.rpcProviders[e]=new Up({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"cosmos":this.rpcProviders[e]=new Lp({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"polkadot":break;case"cip34":this.rpcProviders[e]=new Mp({client:this.client,namespace:this.namespaces[e],events:this.events});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:t}=e,{event:i}=t;i.name==="accountsChanged"?this.events.emit("accountsChanged",i.data):i.name==="chainChanged"?this.onChainChanged(i.data,t.chainId):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var i;const{namespaces:s}=t,c=(i=this.client)==null?void 0:i.session.get(e);this.session=Gp(Cn({},c),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e)})}getProvider(e){if(!this.rpcProviders[e])throw new Error(`Provider not found: ${e}`);return this.rpcProviders[e]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){if(!e||!Object.keys(e).length)throw new Error("Namespaces must be not empty");this.client.core.storage.setItem(`${In}/namespaces`,e),this.namespaces=e}validateChain(e){const[t,i]=(e==null?void 0:e.split(":"))||["",""];if(t&&!Object.keys(this.namespaces).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);return!t||!i?Np(this.namespaces):[t,i]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,t){const[i,s]=this.validateChain(t);this.getProvider(i).setDefaultChain(s),this.events.emit("chainChanged",e)}onConnect(){this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0})}}const ig=Qi;export{ig as UniversalProvider,Qi as default};
